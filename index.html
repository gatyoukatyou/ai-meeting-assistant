<!DOCTYPE html>
<html lang="ja" data-i18n-title="app.pageTitle" data-style="brutalism">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta http-equiv="Content-Security-Policy"
        content="default-src 'self'; base-uri 'self'; object-src 'none'; form-action 'self'; script-src 'self'; connect-src 'self' https://generativelanguage.googleapis.com https://api.openai.com https://api.groq.com https://api.anthropic.com wss://api.deepgram.com https://api.deepgram.com; img-src 'self' data:; style-src 'self' 'unsafe-inline'; font-src 'self' data:; manifest-src 'self';">

  <!-- PWA Manifest -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#4f46e5">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="AI会議">

  <title>AI参加会議</title>
  <style>
    :root{
      /* Common tokens */
      --danger:#EF4444;
      --warning:#F59E0B;
      --success:#10B981;

      /* 背景色上の文字色（white固定排除用） */
      --on-primary:#ffffff;
      --on-danger:#ffffff;
      --modal-header-fg:var(--on-primary);
      --modal-bg:#ffffff;
      --modal-text:#1f2937;

      /* 統一コントロールサイズ */
      --control-h:34px;
      --control-fs:0.85rem;
      --control-px:0.75rem;

      --font-sans:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Inter,"Noto Sans JP",sans-serif;
      --font-serif:"Noto Serif JP","Hiragino Mincho ProN","Yu Mincho","Times New Roman",serif;
      --font-mono:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Courier New",monospace;
      --font-body:var(--font-sans);

      --pattern-size:22px;

      --focus-ring:0 0 0 3px rgba(79,70,229,.35);
    }

    html[data-style="brutalism"]{
      --bg:#E0E7FF;
      --card-bg:#FFFFFF;
      --text:#0B0B0B;
      --text-secondary:#475569;

      --primary:#4F46E5;
      --primary-hover:#4338CA;
      --accent:#F472B6;

      --border-color:#000;
      --border-width:2px;
      --border:var(--border-color);
      --shadow-hard:4px 4px 0 0 #000;
      --shadow-hard-sm:2px 2px 0 0 #000;
      --shadow-modal:8px 8px 0 0 #000;
      --radius:10px;
      --btn-radius:0px; /* Brutalism: 直角 */

      --pattern-dot:rgba(71,85,105,.25);
      --pattern-image:radial-gradient(var(--pattern-dot) 1px, transparent 1px);

      --surface-muted:color-mix(in srgb, var(--bg) 70%, #fff 30%);
      --ai-response-bg:color-mix(in srgb, var(--card-bg) 70%, #F1F5F9 30%);
      --cost-bg:color-mix(in srgb, var(--warning) 70%, #fff 30%);
      --cost-text:#000;
      --accent-blue:#E0E7FF;
      --accent-green:#DCFCE7;
      --accent-border-blue:#C7D2FE;
      --accent-border-green:#A7F3D0;

      --tab-strip-bg:var(--bg);
      --tab-active-bg:var(--card-bg);

      --btn-hover-bg:var(--card-bg);
      --btn-hover-translate:-2px;
      --btn-hover-shadow:4px 4px 0 0 var(--border-color);

      --overlay-bg:rgba(0,0,0,0.5);
      --toast-bg:var(--card-bg);
      --meeting-mode-bg:linear-gradient(135deg, #0f172a 0%, #111827 100%);
      --modal-header-bg:var(--primary);
      --modal-close-color:#fff;

      --font-body:var(--font-sans);
      --textarea-font:var(--font-mono);
    }

    html[data-style="paper"]{
      --bg:#F6F0E7;
      --card-bg:#FFFCF7;
      --text:#2B2A26;
      --text-secondary:#6B645C;

      --primary:#2F4FA5;
      --primary-hover:#264181;
      --accent:#D97706;

      --border-color:#CFC6BA;
      --border-width:1px;
      --border:var(--border-color);
      --shadow-hard:none;
      --shadow-hard-sm:none;
      --shadow-modal:0 8px 20px rgba(0,0,0,0.12);
      --radius:10px;
      --btn-radius:10px; /* Paper: ソフト四角 */

      --pattern-dot:transparent;
      --pattern-image:none;

      --surface-muted:#F1EADD;
      --ai-response-bg:#F7F1E9;
      --cost-bg:#F6E7CC;
      --cost-text:#2B2A26;
      --accent-blue:#E8EEF9;
      --accent-green:#E6F3EA;
      --accent-border-blue:#C9D4EB;
      --accent-border-green:#C7DDCF;

      --tab-strip-bg:transparent;
      --tab-active-bg:var(--card-bg);

      --btn-hover-bg:#F1EADD;
      --btn-hover-translate:0px;
      --btn-hover-shadow:none;

      --overlay-bg:rgba(24,20,16,0.45);
      --toast-bg:var(--card-bg);
      --meeting-mode-bg:linear-gradient(135deg, #2a2218 0%, #16120d 100%);
      --modal-header-bg:var(--primary);
      --modal-close-color:#fff;

      --font-body:var(--font-serif);
      --textarea-font:var(--font-body);
    }

    html[data-style="brutalism"][data-display-theme="dark"]{
      --bg:#0F172A;
      --card-bg:#111C2F;
      --modal-bg:#111C2F;
      --modal-text:#F8FAFC;
      --text:#F8FAFC;
      --text-secondary:#94A3B8;
      --border-color:#F8FAFC;
      --accent-blue:#1E3A5F;
      --accent-green:#14532D;
      --accent-border-blue:#1E40AF;
      --accent-border-green:#166534;
      --pattern-dot:rgba(148,163,184,.18);
      --surface-muted:color-mix(in srgb, var(--bg) 70%, #111827 30%);
      --ai-response-bg:color-mix(in srgb, var(--card-bg) 70%, #0f172a 30%);
      --cost-bg:color-mix(in srgb, var(--warning) 70%, #0f172a 30%);
      --cost-text:#0B0B0B;
      --overlay-bg:rgba(0,0,0,0.6);
      --meeting-mode-bg:linear-gradient(135deg, #0b1020 0%, #0a0f1a 100%);
      --focus-ring:0 0 0 3px rgba(129,140,248,.45);
    }

    html[data-style="paper"][data-display-theme="dark"]{
      --bg:#1F1B16;
      --card-bg:#26211B;
      --modal-bg:#26211B;
      --modal-text:#F5F1E8;
      --text:#F5F1E8;
      --text-secondary:#C9C1B5;
      --border-color:#5C5348;
      --accent-blue:#2A3550;
      --accent-green:#2C3A2E;
      --accent-border-blue:#3A4564;
      --accent-border-green:#3C4A3D;
      --surface-muted:#2D261E;
      --ai-response-bg:#2D261E;
      --cost-bg:#3A2F21;
      --cost-text:#F5F1E8;
      --overlay-bg:rgba(0,0,0,0.6);
      --meeting-mode-bg:linear-gradient(135deg, #1b1611 0%, #110d09 100%);
      --btn-hover-bg:#2E261F;
      --focus-ring:0 0 0 3px rgba(226,232,240,.35);
    }

    *{margin:0;padding:0;box-sizing:border-box;}
    html{color-scheme:light dark;}

    /* Phase 1: 100vh Fixed Layout */
    :root { --app-h: 100vh; }
    @supports (height: 100dvh) {
      :root { --app-h: 100dvh; }
    }

    html, body {
      height: 100vh;
      overflow: hidden;
    }

    body{
      font-family:var(--font-body);
      background-color:var(--bg);
      color:var(--text);
      line-height:1.6;
      /* Dot pattern（重い場合は後で消してOK） */
      background-image:var(--pattern-image);
      background-size:var(--pattern-size) var(--pattern-size);
    }

    /* Mobile fallback - prevent content clipping on small screens */
    @media (max-width: 767px) {
      html, body {
        height: auto;
        min-height: var(--app-h);
        overflow: auto;
      }
    }

    .app-wrapper {
      display: flex;
      flex-direction: column;
      height: 100vh;
      overflow: hidden;
    }

    @media (max-width: 767px) {
      .app-wrapper {
        height: auto;
        min-height: var(--app-h);
      }
    }

    /* fixed背景はモバイルで重いことがあるのでPCだけ */
    @media (min-width: 768px){
      body{ background-attachment:fixed; }
    }

    /* ===== Header ===== */
    .header{
      background:var(--card-bg);
      border-bottom:var(--border-width) solid var(--border-color);
      padding:.6rem 1rem;
      z-index:100;
      box-shadow:var(--shadow-hard);
      flex-shrink: 0;
    }
    .header-row-1{
      display:flex;
      justify-content:space-between;
      align-items:center;
      border-bottom:var(--border-width) dashed var(--border-color);
      padding-bottom:.5rem;
      margin-bottom:.5rem;
      gap:.75rem;
    }
    .header-brand{
      display:flex;
      align-items:center;
      gap:.6rem;
    }
    .header-icon{
      max-height:48px;
      width:auto;
    }
    .header-brand h1{
      font-size:1.1rem;
      line-height:1;
      font-weight:900;
      text-transform:uppercase;
      letter-spacing:-.04em;
      background:var(--primary);
      color:var(--on-primary);
      padding:.25rem .6rem;
      transform:rotate(-1.5deg);
      border:var(--border-width) solid var(--border-color);
      box-shadow:var(--shadow-hard-sm);
    }
    .header-preferences{
      display:flex;
      align-items:center;
      gap:.5rem;
      flex-wrap:wrap;
    }
    .header-row-2{
      display:flex;
      align-items:center;
      gap:.75rem 1rem;
      flex-wrap:wrap;
    }

    /* ===== Bento grid ===== */
    .main-container{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:1.25rem;
      padding:1.25rem 1.5rem;
      max-width:1600px;
      margin:0 auto;
      flex: 1;
      min-height: 0;
      overflow: hidden;
    }
    @media (max-width:1024px){
      .main-container{ grid-template-columns:1fr; }
    }

    /* ===== Panels ===== */
    .panel{
      background:var(--card-bg);
      border:var(--border-width) solid var(--border-color);
      border-radius:var(--radius);
      box-shadow:var(--shadow-hard);
      overflow:hidden;
      display:flex;
      flex-direction:column;
      height: 100%;
      min-height: 0;
    }
    .panel-header{
      background:var(--surface-muted);
      border-bottom:var(--border-width) solid var(--border-color);
      padding:.85rem 1.15rem;
      font-weight:900;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:.75rem;
      flex-shrink: 0;
    }
    .panel-title{
      font-size:1.05rem;
      text-transform:uppercase;
    }
    .panel-body{
      padding:1.15rem;
      overflow:auto;
      flex:1;
      min-height: 0;
    }

    /* ===== Buttons ===== */
    .btn{
      border:var(--border-width) solid var(--border-color);
      border-radius:var(--radius);
      height:var(--control-h);
      padding:0 var(--control-px);
      font-size:var(--control-fs);
      font-weight:800;
      cursor:pointer;
      box-shadow:var(--shadow-hard-sm);
      transition:transform .12s ease, box-shadow .12s ease, background .12s ease;
      background:var(--card-bg);
      color:var(--text);
      display:inline-flex;
      align-items:center;
      gap:.5rem;
      user-select:none;
    }
    .btn:hover{
      transform:translate(var(--btn-hover-translate), var(--btn-hover-translate));
      box-shadow:var(--btn-hover-shadow);
      background:var(--btn-hover-bg);
    }
    .btn:active{
      transform:translate(0,0);
      box-shadow:none;
    }
    .btn-primary{ background:var(--primary); color:var(--on-primary); }
    .btn-primary:hover{ background:var(--primary-hover); }
    .btn-danger{ background:var(--danger); color:var(--on-danger); }

    /* ===== Inputs ===== */
    input, select, textarea{
      border:var(--border-width) solid var(--border-color);
      border-radius:var(--radius);
      padding:0 var(--control-px);
      min-height:var(--control-h);
      font-size:var(--control-fs);
      background:var(--card-bg);
      color:var(--text);
      font-family:inherit;
      box-shadow:inset 2px 2px 0 rgba(0,0,0,.08);
    }
    textarea{ font-family:var(--textarea-font); }
    input:focus, select:focus, textarea:focus{ outline:none; box-shadow: var(--focus-ring); }

    /* :focus-visible を優先（キーボード操作の見え方が良くなる） */
    :focus-visible{ outline:none; box-shadow: var(--focus-ring); }

    /* ===== Transcript / Code-ish areas ===== */
    .transcript-text, pre, code{
      font-family:var(--font-mono);
      font-size:.95rem;
      line-height:1.8;
    }

    /* ===== AI response blocks ===== */
    .ai-response{
      background:var(--ai-response-bg);
      border:var(--border-width) solid var(--border-color);
      border-radius:var(--radius);
      padding:1rem;
      margin-bottom:1rem;
      position:relative;
      box-shadow:var(--shadow-hard-sm);
    }

    /* ===== Tabs ===== */
    .tabs{
      display:flex;
      border-bottom:var(--border-width) solid var(--border-color);
      background:var(--tab-strip-bg);
      gap:0;
      flex-shrink: 0;
    }
    .tab{
      padding:.7rem 1rem;
      border:none;
      background:transparent;
      font-weight:700;
      cursor:pointer;
      color:var(--text-secondary);
      border-bottom: 2px solid transparent;
    }
    .tab.active{
      color:var(--primary);
      border-bottom-color:var(--primary);
      background:transparent;
    }

    /* ===== Cost display ===== */
    .cost-display{
      background:var(--cost-bg);
      border-top:var(--border-width) solid var(--border-color);
      color:var(--cost-text);
      padding:.75rem;
      flex-shrink: 0;
    }
    .cost-badge{
      border:var(--border-width) solid var(--border-color);
      background:#fff;
      color:#000;
      font-weight:900;
      border-radius:999px;
      padding:.12rem .55rem;
    }

    /* ===== Cost Chip Bar (Phase 2) ===== */
    .cost-chip-bar {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.5rem 1rem;
      background: var(--surface-muted);
      border-top: var(--border-width) solid var(--border-color);
      flex-shrink: 0;
      font-size: 0.85rem;
    }

    .cost-chip {
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      padding: 0.3rem 0.65rem;
      background: var(--cost-bg);
      border: var(--border-width) solid var(--border-color);
      border-radius: 999px;
      font-weight: 700;
      cursor: pointer;
      box-shadow: var(--shadow-hard-sm);
      transition: transform 0.1s, box-shadow 0.1s;
      font-size: 0.85rem;
    }

    .cost-chip:hover {
      transform: translate(-1px, -1px);
      box-shadow: 2px 2px 0 0 var(--border-color);
    }

    .cost-chip .chip-cost-badge,
    .chip-cost-badge {
      font-size: 0.7rem;
      padding: 0.08rem 0.35rem;
      border: var(--border-width) solid var(--border-color);
      background: #fff;
      border-radius: 999px;
      font-weight: 700;
    }

    .cost-total-inline {
      font-weight: 700;
      color: var(--text-secondary);
    }

    /* ===== Cost Popover ===== */
    .cost-popover {
      position: fixed;
      z-index: 1100;
      background: var(--card-bg);
      border: var(--border-width) solid var(--border-color);
      border-radius: var(--radius);
      box-shadow: var(--shadow-modal);
      padding: 1rem;
      min-width: 260px;
      max-width: 340px;
      display: none;
    }

    .cost-popover.open { display: block; }

    .cost-popover .cost-section { margin-bottom: 0.6rem; }
    .cost-popover .cost-section:last-child { margin-bottom: 0; }

    .cost-popover .cost-section-title {
      font-weight: 800;
      font-size: 0.75rem;
      text-transform: uppercase;
      color: var(--text-secondary);
      margin-bottom: 0.3rem;
      border-bottom: 1px dashed var(--border-color);
      padding-bottom: 0.2rem;
    }

    .cost-popover .cost-item {
      display: flex;
      justify-content: space-between;
      padding: 0.1rem 0;
      font-size: 0.85rem;
    }

    .cost-popover .cost-item-label { color: var(--text-secondary); }

    #costWarningInline {
      display: none;
      font-size: 0.8rem;
      padding: 0.25rem 0.5rem;
      background: #fee2e2;
      border-radius: var(--radius);
      color: #991b1b;
    }
    #costWarningInline.show { display: inline-block; }

    /* ===== Footer ===== */
    footer { flex-shrink: 0; }

    /* ===== Modals ===== */
    .modal{
      border:var(--border-width) solid var(--border-color);
      box-shadow:var(--shadow-modal);
      border-radius:var(--radius);
      background:var(--modal-bg);
      color:var(--modal-text);
      opacity:1; /* 明示的に不透明 */
    }
    .modal-header{
      background:var(--modal-header-bg);
      color:var(--modal-header-fg);
      border-bottom:var(--border-width) solid var(--border-color);
    }
    .modal-close{ color:var(--modal-close-color); }

    /* ===== Scrollbars (WebKit) ===== */
    ::-webkit-scrollbar{ width:12px; height:12px; }
    ::-webkit-scrollbar-track{
      background:var(--bg);
      border-left:var(--border-width) solid var(--border-color);
    }
    ::-webkit-scrollbar-thumb{
      background:var(--primary);
      border:var(--border-width) solid var(--border-color);
    }
    ::-webkit-scrollbar-thumb:hover{ background:var(--primary-hover); }

    /* ===== Responsive ===== */
    @media (max-width: 767px){
      .header-row-1{ flex-direction:column; align-items:flex-start; }
      /* row-2は横並び維持（アイコンのみ表示で1行成立させる） */
      .header-row-2{
        flex-direction: row;
        flex-wrap: wrap;
        align-items: center;
        gap: 0.35rem;
      }
      .header-record{
        display: inline-flex;
        flex-wrap: wrap;
        align-items: center;
        gap: 0.35rem;
      }
      .btn{ width:auto; justify-content:center; }
      .panel{ min-height:420px; height: auto; }
    }

    /* ===== Reduced motion ===== */
    @media (prefers-reduced-motion: reduce){
      *{ transition:none !important; }
    }

    /* ===== Meeting Mode (会議モード - Panel Toggle) ===== */
    .main-container.meeting-mode #transcriptPanel {
      display: none;
    }

    .main-container.meeting-mode #aiPanel {
      grid-column: 1 / -1;
    }

    @media (min-width: 1025px) {
      .main-container.meeting-mode {
        grid-template-columns: 1fr;
        max-width: none;
        width: 100%;
        padding-left: 2.5rem;
        padding-right: 2.5rem;
      }
    }

    /* Meeting Mode Toggle Chip */
    .meeting-mode-chip {
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      height: var(--control-h);
      padding: 0 var(--control-px);
      background: var(--accent-blue);
      color: var(--text);
      border: var(--border-width) solid var(--border-color);
      border-radius: 999px;
      font-size: var(--control-fs);
      font-weight: 700;
      cursor: pointer;
      transition: background 0.15s, color 0.15s;
      box-shadow: var(--shadow-hard-sm);
    }

    .meeting-mode-chip:hover {
      background: var(--primary);
      color: var(--on-primary);
    }

    .meeting-mode-chip.edit-mode {
      background: var(--accent-green);
    }

    /* ===== STT Status Chip (Progressive Disclosure) ===== */
    .stt-status-chip {
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      height: var(--control-h);
      padding: 0 var(--control-px);
      background: var(--surface-muted);
      color: var(--text);
      border: var(--border-width) solid var(--border-color);
      border-radius: 999px;
      font-size: var(--control-fs);
      font-weight: 700;
      cursor: pointer;
      transition: background 0.15s, box-shadow 0.15s, color 0.15s;
      box-shadow: var(--shadow-hard-sm);
    }

    .stt-status-chip:hover {
      background: var(--accent-blue);
      box-shadow: 2px 2px 0 0 var(--border-color);
    }

    .stt-status-chip.expanded {
      background: var(--primary);
      color: var(--on-primary);
    }

    /* STT Controls - collapsed by default */
    .header-stt-controls.collapsed {
      display: none;
    }

    .header-stt-controls.expanded {
      display: flex;
      animation: slideIn 0.15s ease-out;
    }

    @keyframes slideIn {
      from { opacity: 0; transform: translateX(-10px); }
      to { opacity: 1; transform: translateX(0); }
    }

    /* ===== Enhancement Badges ===== */
    .enhancement-badge {
      display: none;
      padding: 0.2rem 0.5rem;
      border-radius: 4px;
      font-size: 0.75rem;
      font-weight: 600;
      margin-left: 0.5rem;
      color: var(--on-primary);
    }
    .enhancement-badge.active {
      display: inline-flex;
      align-items: center;
    }
    .enhancement-badge.boost {
      background: var(--accent);
    }
    .enhancement-badge.native-docs {
      background: #10b981;
    }

    /* ===== Memo Input ===== */
    .memo-input-section {
      padding: 0.75rem 0;
      border-top: var(--border-width) dashed var(--border-color);
      margin-top: 0.5rem;
      flex-shrink: 0;
    }

    .memo-input-row {
      display: flex;
      gap: 0.5rem;
      align-items: flex-end;
    }

    .memo-input-row textarea {
      flex: 1;
      min-height: 50px;
      resize: vertical;
    }

    /* ===== Timeline ===== */
    .timeline-controls {
      padding: 0.75rem 0;
      border-bottom: 1px dashed var(--border-color);
    }

    .timeline-filters {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .timeline-filter {
      height: var(--control-h);
      padding: 0 var(--control-px);
      border: var(--border-width) solid var(--border-color);
      border-radius: var(--radius);
      background: transparent;
      color: var(--text);
      cursor: pointer;
      font-size: var(--control-fs);
      font-weight: 600;
      display: inline-flex;
      align-items: center;
    }

    .timeline-filter.active {
      background: var(--primary);
      color: var(--on-primary);
    }

    .timeline-list {
      overflow-y: auto;
      flex: 1;
      min-height: 0;
      padding: 0.5rem 0;
    }

    /* ===== Timeline Items ===== */
    .timeline-item {
      padding: 0.75rem;
      border: var(--border-width) solid var(--border-color);
      border-radius: var(--radius);
      margin-bottom: 0.5rem;
      background: var(--card-bg);
    }

    .timeline-item.pinned {
      border-color: var(--warning);
      background: var(--cost-bg);
    }

    .timeline-item.todo.completed {
      opacity: 0.6;
    }

    .timeline-item.todo.completed .timeline-item-content {
      text-decoration: line-through;
    }

    .timeline-item-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
      gap: 0.5rem;
    }

    .timeline-item-meta {
      font-size: 0.75rem;
      color: var(--text-secondary);
    }

    .timeline-item-actions {
      display: flex;
      gap: 0.25rem;
    }

    .timeline-item-actions button {
      padding: 0.2rem 0.4rem;
      font-size: 0.75rem;
      background: transparent;
      border: 1px solid var(--border-color);
      border-radius: 4px;
      cursor: pointer;
    }

    .timeline-item-actions button:hover {
      background: var(--surface-muted);
    }

    .timeline-item-content {
      font-size: 0.9rem;
      line-height: 1.5;
      white-space: pre-wrap;
    }

    .timeline-item-quote {
      margin-top: 0.5rem;
      padding: 0.5rem;
      background: var(--surface-muted);
      border-left: 3px solid var(--primary);
      font-size: 0.8rem;
      color: var(--text-secondary);
      white-space: pre-wrap;
    }

    /* ===== Tabs: content panes ===== */
    .tab-content{
      display:none;
      padding:1rem;
      overflow:auto;
      flex: 1;
      min-height: 0;
    }
    .tab-content.active{ display:block; }

    /* ===== AI Section ===== */
    .ai-section {
      flex-shrink: 0;
    }

    .custom-question {
      display: flex;
      gap: 0.75rem;
      padding-top: 0.75rem;
      margin-top: 0.5rem;
      border-top: 1px dashed var(--border-color);
      align-items: flex-end;
    }

    .custom-question textarea {
      flex: 1;
      min-height: 60px;
    }

    /* ===== Modal overlays ===== */
    .modal-overlay{
      display:none;
      position:fixed;
      top:0;
      left:0;
      right:0;
      bottom:0;
      background:var(--overlay-bg);
      z-index:1000;
      justify-content:center;
      align-items:center;
      padding:1rem;
    }
    .modal-overlay.active{ display:flex; }
    .modal-body{
      padding:1.5rem;
      overflow-y:auto;
      max-height:calc(90vh - 140px);
      -webkit-overflow-scrolling:touch;
      overscroll-behavior:contain;
    }
    .modal-footer{
      padding:1rem 1.5rem;
      border-top:var(--border-width) solid var(--border-color);
      display:flex;
      justify-content:flex-end;
      gap:.75rem;
    }
    .modal-close{
      background:none;
      border:none;
      font-size:1.5rem;
      cursor:pointer;
      line-height:1;
    }
    body.modal-open{
      overflow:hidden;
      position:fixed;
      width:100%;
      height:100%;
    }

    /* ===== Mobile main tabs ===== */
    .main-tabs{ display:none; }
    @media (min-width: 768px) and (max-width: 1024px){
      .main-tabs{
        display:flex;
        background:var(--card-bg);
        border-bottom:var(--border-width) solid var(--border-color);
        position:sticky;
        top:0;
        z-index:90;
      }
      .main-tab{
        flex:1;
        padding:1rem;
        border:none;
        background:transparent;
        font-weight:900;
        color:var(--text-secondary);
        cursor:pointer;
        border-bottom:var(--border-width) solid transparent;
      }
      .main-tab.active{
        color:var(--text);
        background:var(--tab-active-bg);
        border-bottom-color:var(--border-color);
      }
      .main-container{
        padding:0;
        gap:0;
      }
      .main-container .panel{
        display:none;
        border-radius:0;
        border-left:none;
        border-right:none;
        box-shadow:none;
      }
      .main-container .panel.active{ display:flex; }
    }

    /* ===== Floating stop button ===== */
    .floating-stop-btn{
      display:none;
      position:fixed;
      bottom:2rem;
      left:50%;
      transform:translateX(-50%);
      z-index:1500;
      padding:1rem 3rem;
      font-size:1.25rem;
      font-weight:900;
      border-radius:999px;
      box-shadow:var(--shadow-hard);
    }
    .floating-stop-btn.visible{
      display:flex;
      align-items:center;
      gap:.75rem;
    }
    @media (min-width: 768px){
      .floating-stop-btn{ display:none !important; }
    }
    @media (max-width: 767px){
      .floating-stop-btn{
        bottom:1.5rem;
        padding:1.25rem 2.5rem;
        font-size:1.125rem;
        min-height:60px;
      }
    }

    /* ===== Meeting mode ===== */
    .meeting-mode-overlay{
      display:none;
      position:fixed;
      top:0;
      left:0;
      right:0;
      bottom:0;
      background:var(--meeting-mode-bg);
      z-index:2000;
      flex-direction:column;
      justify-content:center;
      align-items:center;
      padding:2rem;
    }
    .meeting-mode-overlay.active{ display:flex; }
    .meeting-mode-status{
      text-align:center;
      color:var(--on-primary);
      margin-bottom:3rem;
    }
    .meeting-mode-icon{
      font-size:4rem;
      margin-bottom:1rem;
    }
    .meeting-mode-text{
      font-size:1.5rem;
      font-weight:900;
      margin-bottom:.5rem;
    }
    .meeting-mode-time{
      font-size:3rem;
      font-weight:300;
      font-family:var(--font-mono);
      letter-spacing:.1em;
    }
    .meeting-mode-hint{
      font-size:.875rem;
      color:rgba(255,255,255,.65);
      margin-top:1rem;
    }
    .meeting-mode-stop-btn{
      padding:1.5rem 4rem;
      font-size:1.25rem;
      font-weight:900;
      border-radius:999px;
      margin-bottom:1.5rem;
    }
    .meeting-mode-exit-btn{
      padding:.75rem 2rem;
      font-size:.875rem;
      background:rgba(255,255,255,.1);
      color:rgba(255,255,255,.85);
      border:var(--border-width) solid rgba(255,255,255,.2);
      border-radius:999px;
      cursor:pointer;
    }
    .meeting-mode-exit-btn:hover{ background:rgba(255,255,255,.2); }
    .meeting-mode-toggle{ display:none; }
    /* モバイルでは会議モード切替を非表示（下部タブで代用） */
    @media (max-width: 767px){
      .meeting-mode-toggle{ display:none !important; }
      #meetingModeChip{ display:none !important; }
    }

    /* ===== Toasts ===== */
    .toast-container{
      position:fixed;
      top:1rem;
      right:1rem;
      z-index:2000;
      display:flex;
      flex-direction:column;
      gap:.5rem;
      pointer-events:none;
    }
    .toast{
      pointer-events:auto;
      background:var(--toast-bg);
      border:var(--border-width) solid var(--border-color);
      border-left:6px solid var(--primary);
      border-radius:var(--radius);
      padding:.85rem 1rem;
      box-shadow:var(--shadow-hard-sm);
      display:flex;
      align-items:center;
      gap:.75rem;
    }
    .toast.error{ border-left-color:var(--danger); }
    .toast.success{ border-left-color:var(--success); }
    .toast.warning{ border-left-color:var(--warning); }
    .toast-message{ font-size:.9rem; line-height:1.4; }

    /* ===== Task A: AI Buttons をタブに統合 ===== */
    /* AI Buttonsを非表示化（タブに統合） */
    .ai-buttons {
      display: none;
    }

    /* タブを横スクロール可能に */
    .tabs {
      padding: 0 1rem;
      gap: 0.25rem;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none;
    }
    .tabs::-webkit-scrollbar {
      display: none;
    }

    /* タブのスタイル調整 */
    .tab {
      white-space: nowrap;
      padding: 0.65rem 0.85rem;
      font-size: 0.85rem;
      line-height: 1.2;
    }

    /* Custom Question セクションを調整 */
    .custom-question {
      padding: 0.75rem 1rem;
      border-top: var(--border-width) dashed var(--border-color);
      margin-top: 0;
    }

    .custom-question textarea {
      min-height: 42px;
      max-height: 120px;
    }

    /* ===== Task B: モバイルヘッダー縮約 ===== */
    /* Moreボタン */
    .header-more-btn {
      display: none;
      height: var(--control-h);
      padding: 0 var(--control-px);
      background: var(--surface-muted);
      color: var(--text);
      border: var(--border-width) solid var(--border-color);
      border-radius: var(--radius);
      font-size: var(--control-fs);
      cursor: pointer;
      align-items: center;
    }

    /* Moreメニュー（popover風） */
    .header-more-menu {
      display: none;
      position: fixed;
      top: auto;
      right: 1rem;
      bottom: auto;
      z-index: 1100;
      background: var(--card-bg);
      border: var(--border-width) solid var(--border-color);
      border-radius: var(--radius);
      box-shadow: var(--shadow-hard);
      padding: 0.5rem;
      min-width: 200px;
    }

    .header-more-menu.open {
      display: block;
    }

    .header-more-menu-item {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.6rem 0.75rem;
      border: none;
      background: transparent;
      width: 100%;
      text-align: left;
      font-size: 0.85rem;
      cursor: pointer;
      border-radius: calc(var(--radius) - 2px);
      color: var(--text);
    }

    .header-more-menu-item:hover {
      background: var(--surface-muted);
    }

    /* ===== タブレット/ハーフ幅（768–1024px）での More 表示 ===== */
    @media (min-width: 768px) and (max-width: 1024px) {
      /* More ボタンを表示 */
      .header-more-btn {
        display: inline-flex;
        align-items: center;
        gap: 0.25rem;
      }

      /* P2要素を More に格納 */
      #openContextModalBtn,
      #contextStatusBadge,
      .header-export {
        display: none !important;
      }

      /* ヘッダー2段目の gap を詰める */
      .header-row-2 {
        gap: 0.4rem;
      }
    }

    /* モバイルでの表示制御 */
    @media (max-width: 767px) {
      /* Moreボタンを表示 */
      .header-more-btn {
        display: flex;
        align-items: center;
        gap: 0.25rem;
      }

      /* 以下をMoreに格納（非表示） */
      #openContextModalBtn,
      #contextStatusBadge,
      .header-export,
      #openLLMSettingsBtn,
      #openFullSettingsBtn {
        display: none !important;
      }

      /* #74: mobile header compact - hide STT chip & expanded controls */
      #sttStatusChip,
      #headerSttControls {
        display: none !important;
      }

      /* ===== ボタンラベルを隠してアイコンのみ（1行成立） ===== */
      .record-btn .btn-label {
        display: none;
      }

      #meetingModeChip .btn-label {
        display: none;
      }

      .export-btn .export-btn-text {
        display: none;
      }

      /* ボタン幅を auto に（モバイルで100%解除） */
      .header-row-2 .btn,
      .header-row-2 .record-btn {
        width: auto;
      }

      /* Enhancement バッジを隠す */
      .enhancement-badge {
        display: none;
      }
    }

    /* ===== Task D: STT設定の展開改善 ===== */
    /* ヘッダーrow-2をrelativeに（必須） */
    .header-row-2 {
      position: relative;
      overflow: visible;
    }

    /* ヘッダー全体もoverflowをvisibleに（念のため） */
    .header {
      overflow: visible;
    }

    /* 展開時にヘッダーを破壊しないよう制御 */
    #headerSttControls.expanded {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: var(--card-bg);
      border-top: var(--border-width) solid var(--border-color);
      padding: 0.75rem 1rem;
      box-shadow: var(--shadow-hard);
      z-index: 95;
      animation: slideDown 150ms ease-out;
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      align-items: center;
    }

    @keyframes slideDown {
      from { opacity: 0; transform: translateY(-8px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* ===== Clean Theme (Monochrome) ===== */
    html[data-style="clean"] {
      /* Shape & shadow */
      --border-width: 1px;
      --radius: 6px;
      --btn-radius: 6px;
      --shadow: none;
      --shadow-hard: 0 1px 3px rgba(0,0,0,0.08);
      --shadow-hard-sm: 0 1px 2px rgba(0,0,0,0.05);
      --shadow-modal: 0 4px 12px rgba(0,0,0,0.15);
      --border-color: #e5e7eb;
      --overlay-bg: rgba(0,0,0,0.62);
      --modal-bg: #ffffff;
      --modal-text: #1f2937;

      /* Light mode colors (Notion-like) */
      --bg: #ffffff;
      --card-bg: #ffffff;
      --text: #111827;
      --text-secondary: #6b7280;
      --primary: #111827;
      --primary-hover: #374151;
      --accent: #6b7280;
      --border: var(--border-color);
      --pattern-dot: transparent;
      --pattern-image: none;
      --surface-muted: #f9fafb;
      --ai-response-bg: #f9fafb;
      --cost-bg: #fef3c7;
      --cost-text: #111827;
      --accent-blue: #f3f4f6;
      --accent-green: #f0fdf4;
      --accent-border-blue: #e5e7eb;
      --accent-border-green: #d1fae5;
      --tab-strip-bg: transparent;
      --tab-active-bg: var(--card-bg);
      --btn-hover-bg: #f3f4f6;
      --btn-hover-translate: 0px;
      --btn-hover-shadow: none;
      --toast-bg: var(--card-bg);
      --meeting-mode-bg: linear-gradient(135deg, #111827 0%, #1f2937 100%);
      --modal-header-bg: #111827;
      --modal-close-color: #fff;
      --font-body: var(--font-sans);
      --textarea-font: var(--font-sans);
    }

    html[data-style="clean"] .btn {
      box-shadow: none;
      border-width: 1px;
    }

    html[data-style="clean"] .btn-primary {
      background: #111827;
      border-color: #111827;
    }

    html[data-style="clean"] .btn-primary:hover {
      background: #374151;
      border-color: #374151;
    }

    html[data-style="clean"] .panel {
      box-shadow: 0 1px 3px rgba(0,0,0,0.05);
      border-width: 1px;
    }

    html[data-style="clean"] .card {
      box-shadow: none;
      border-width: 1px;
    }

    /* Dark mode clean */
    html[data-style="clean"][data-display-theme="dark"] {
      --bg:#111827;
      --card-bg:#1F2937;
      --modal-bg:#1F2937;
      --modal-text:#F9FAFB;
      --text:#F9FAFB;
      --text-secondary:#9CA3AF;
      --border-color:#374151;
      --surface-muted:#1F2937;
      --ai-response-bg:#1F2937;
      --cost-bg:color-mix(in srgb, var(--warning) 70%, #111827 30%);
      --cost-text:#F9FAFB;
      --accent-blue:#1E3A5F;
      --accent-green:#14532D;
      --accent-border-blue:#1E40AF;
      --accent-border-green:#166534;
      --overlay-bg:rgba(0,0,0,0.7);
      --meeting-mode-bg:linear-gradient(135deg, #0f172a 0%, #111827 100%);
      --focus-ring:0 0 0 3px rgba(129,140,248,.45);
    }

    /* ===== CLI Theme (Terminal/Hacker - Chic Emerald) ===== */
    html[data-style="cli"] {
      /* darker, less neon base */
      --bg: #0b0f0e;
      --card-bg: #101816;
      /* chic emerald tones (no neon) */
      --text: #d1fae5;
      --text-secondary: #6ee7b7;
      --primary: #34d399;
      --primary-hover: #10b981;
      --accent: #34d399;
      /* thinner lines */
      --border-color: #065f46;
      --border-width: 0.75px;
      --border: var(--border-color);
      --radius: 0;
      --btn-radius: 0;
      /* remove neon glow */
      --shadow-hard: none;
      --shadow-hard-sm: none;
      --shadow-modal: 0 12px 30px rgba(0,0,0,0.55);
      /* subtle pattern */
      --pattern-dot: rgba(52,211,153,0.04);
      --pattern-image: radial-gradient(var(--pattern-dot) 1px, transparent 1px);
      --surface-muted: #14201c;
      --ai-response-bg: #14201c;
      --cost-bg: #132018;
      --cost-text: #d1fae5;
      --accent-blue: #0b1512;
      --accent-green: #0f1c17;
      --accent-border-blue: #064e3b;
      --accent-border-green: #065f46;
      --tab-strip-bg: var(--bg);
      --tab-active-bg: var(--card-bg);
      /* stop hover glow */
      --btn-hover-bg: #14201c;
      --btn-hover-translate: 0px;
      --btn-hover-shadow: none;
      --overlay-bg: rgba(0,0,0,0.85);
      --toast-bg: var(--card-bg);
      --meeting-mode-bg: linear-gradient(135deg, #070a09 0%, #0b0f0e 100%);
      --modal-bg: #101816;
      --modal-text: #d1fae5;
      --modal-header-bg: #0b0f0e;
      --modal-close-color: #d1fae5;
      --on-primary: #06110d;
      --font-body: var(--font-mono);
      --textarea-font: var(--font-mono);
      /* thinner, calmer focus */
      --focus-ring: 0 0 0 1px rgba(52,211,153,0.35);
    }

    /* CLI button styling */
    html[data-style="cli"] .btn {
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    html[data-style="cli"] .btn-primary {
      background: transparent;
      color: var(--primary);
      border-color: var(--primary);
    }
    html[data-style="cli"] .btn-primary:hover {
      background: var(--primary);
      color: #06110d;
      box-shadow: none;
    }
    html[data-style="cli"] .panel-header {
      text-transform: uppercase;
      letter-spacing: 0.1em;
    }

    /* CLI: Mobile bottom tabs - outline style */
    @media (max-width: 767px) {
      html[data-style="cli"] .main-tab {
        background: var(--card-bg);
        color: var(--primary);
        border: 2px solid var(--primary);
      }
      html[data-style="cli"] .main-tab:active {
        background: var(--surface-muted);
      }
      html[data-style="cli"] .main-tab.active {
        background: var(--surface-muted);
        border-color: var(--primary-hover);
      }
    }

    /* CLI: Dark mode override (chic emerald - same as base) */
    html[data-style="cli"][data-display-theme="dark"] {
      --bg: #0b0f0e;
      --card-bg: #101816;
      --text: #d1fae5;
      --text-secondary: #6ee7b7;
      --primary: #34d399;
      --primary-hover: #10b981;
      --border-color: #065f46;
      --border-width: 0.75px;
      --border: var(--border-color);
      --shadow-hard: none;
      --shadow-hard-sm: none;
      --btn-hover-shadow: none;
      --surface-muted: #14201c;
      --ai-response-bg: #14201c;
      --cost-bg: #132018;
      --cost-text: #d1fae5;
      --accent-blue: #0b1512;
      --accent-green: #0f1c17;
      --accent-border-blue: #064e3b;
      --accent-border-green: #065f46;
      --overlay-bg: rgba(0,0,0,0.85);
      --toast-bg: var(--card-bg);
      --meeting-mode-bg: linear-gradient(135deg, #070a09 0%, #0b0f0e 100%);
      --modal-bg: #101816;
      --modal-text: #d1fae5;
      --modal-header-bg: #0b0f0e;
      --modal-close-color: #d1fae5;
      --focus-ring: 0 0 0 1px rgba(52,211,153,0.35);
    }

    /* CLI: Light mode (terminal on paper) */
    html[data-style="cli"][data-display-theme="light"] {
      --bg: #f8fafc;
      --card-bg: #ffffff;
      --text: #0f172a;
      --text-secondary: #334155;
      --primary: #0f172a;
      --primary-hover: #334155;
      --accent: #0f766e;
      --border-color: #cbd5e1;
      --border: var(--border-color);
      --surface-muted: #f1f5f9;
      --ai-response-bg: #f1f5f9;
      --cost-bg: #fff7ed;
      --cost-text: #0f172a;
      --accent-blue: #e2e8f0;
      --accent-green: #ecfeff;
      --accent-border-blue: #cbd5e1;
      --accent-border-green: #a5f3fc;
      --overlay-bg: rgba(0,0,0,0.35);
      --toast-bg: var(--card-bg);
      --meeting-mode-bg: linear-gradient(135deg, #0f172a 0%, #334155 100%);
      --modal-bg: #ffffff;
      --modal-text: #0f172a;
      --modal-header-bg: #0f172a;
      --modal-close-color: #fff;
      --focus-ring: 0 0 0 2px rgba(15,118,110,0.35);
    }

    /* ===== PR-2: Mobile Fixed Top Bar (Task A) ===== */
    @media (max-width: 767px) {
      :root {
        --mobile-topbar-h: 64px;
        --mobile-bottombar-h: 64px;
      }

      /* ヘッダー固定 */
      .header {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        z-index: 1200;
        background: var(--card-bg);
      }

      /* 1段目（ブランド行）は非表示 */
      .header-row-1 {
        display: none;
      }

      /* 2段目をTop Barとしてコンパクトに */
      .header-row-2 {
        padding: 0.35rem 0.5rem;
        gap: 0.5rem;
        align-items: center;
      }

      /* 本文が固定ヘッダーに潜り込まないように */
      .app-wrapper {
        padding-top: var(--mobile-topbar-h);
      }

      /* STT展開はheader-row-2がfixedでも見えるように */
      #headerSttControls.expanded {
        z-index: 1250;
      }
    }

    /* ===== PR-2: Mobile Fixed Bottom Tab Bar (Task B) ===== */
    @media (max-width: 767px) {
      .main-tabs {
        position: fixed;
        left: 0;
        right: 0;
        bottom: 0;
        bottom: env(safe-area-inset-bottom, 0);
        top: auto;
        z-index: 1200;
        background: var(--card-bg);
        border-top: var(--border-width) solid var(--border-color);
        border-bottom: none;
        padding: 0.5rem 0.75rem calc(env(safe-area-inset-bottom, 0px) + 0.5rem);
        display: flex;
        justify-content: center;
        gap: 0.75rem;
      }

      .main-tab {
        flex: 1;
        max-width: 200px;
        text-align: center;
        min-height: 40px;
        padding: 0.5rem 1rem;
        font-size: 0.9rem;
        font-weight: 600;
        border-radius: 8px;
        touch-action: manipulation;
        background: var(--primary);
        color: var(--on-primary);
        border: none;
        box-shadow: 0 2px 6px rgba(0,0,0,0.12);
        transition: transform 0.1s, box-shadow 0.1s;
      }
      .main-tab:active {
        transform: scale(0.97);
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      }
      .main-tab.active {
        background: var(--primary-hover);
        box-shadow: 0 2px 8px rgba(0,0,0,0.18);
      }
      /* 内側要素がタップターゲットを奪うのを防ぐ（iOS Safari対策） */
      .main-tab * {
        pointer-events: none;
      }

      /* パネル切り替え（スマホ用） */
      .main-container .panel {
        display: none;
      }
      .main-container .panel.active {
        display: flex;
      }

      .app-wrapper {
        padding-bottom: calc(var(--mobile-bottombar-h) + env(safe-area-inset-bottom, 0px));
      }

      /* フッターがBottomバーと干渉するのでモバイルで非表示 */
      footer {
        display: none;
      }
    }

    /* ===== PR-2: Scroll Header Shrink (Task C) ===== */
    @media (max-width: 767px) {
      body.is-scrolled .header-row-2 {
        padding: 0.2rem 0.45rem;
      }

      /* チップ類の縮小 */
      body.is-scrolled #sttStatusChip {
        font-size: 0.7rem;
        padding: 0.2rem 0.45rem;
      }

      /* Moreボタンもコンパクトに */
      body.is-scrolled .header-more-btn {
        padding: 0.25rem 0.45rem;
      }

      /* 録音ボタンの縮小 */
      body.is-scrolled .record-btn {
        padding: 0.4rem 0.7rem;
        font-size: 0.85rem;
        min-height: 36px;
      }

      /* ステータスバッジの縮小 */
      body.is-scrolled .status-badge {
        font-size: 0.7rem;
        padding: 0.15rem 0.4rem;
      }

      /* モードチップの縮小 */
      body.is-scrolled .meeting-mode-chip {
        font-size: 0.7rem;
        padding: 0.2rem 0.45rem;
      }
    }

    /* ===== PR-2: Keyboard Avoidance (Task E) ===== */
    @media (max-width: 767px) {
      body.keyboard-open .main-tabs {
        display: none;
      }

      body.keyboard-open .app-wrapper {
        padding-bottom: 0;
      }
    }

    /* ===== PR-3: エンプティステート (Empty State) ===== */
    .empty-state {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 2rem 1rem;
      min-height: 200px;
    }

    .empty-state-icon {
      font-size: 3rem;
      margin-bottom: 1rem;
      opacity: 0.7;
    }

    .empty-state-title {
      font-size: 1.1rem;
      font-weight: 600;
      color: var(--text);
      margin-bottom: 0.5rem;
    }

    .empty-state-desc {
      font-size: 0.85rem;
      color: var(--text-secondary);
      margin-bottom: 1.25rem;
      max-width: 280px;
      line-height: 1.5;
    }

    .empty-state .btn {
      padding: 0.75rem 1.5rem;
      font-size: 0.95rem;
    }

    /* 生成後は非表示 */
    .empty-state.has-content {
      display: none;
    }

    /* 再生成ボタン */
    .regenerate-btn {
      position: absolute;
      top: 0.5rem;
      right: 0.5rem;
      padding: 0.4rem 0.6rem;
      font-size: 0.75rem;
      background: var(--surface-muted);
      border: var(--border-width) solid var(--border-color);
      border-radius: var(--btn-radius, 6px);
      cursor: pointer;
      opacity: 0.7;
      transition: opacity 0.15s;
    }

    .regenerate-btn:hover {
      opacity: 1;
    }

    .tab-content {
      position: relative;
    }

    /* ===== PR-3: 自由入力欄をタブ内に限定 (Task B) ===== */
    /* AIパネル上部の自由質問フォームを非表示 */
    .ai-section > .custom-question {
      display: none;
    }

    /* AIパネル上部のメモ入力も非表示（タブ内のみ） */
    .ai-section > .memo-input-section {
      display: none !important;
    }

    /* Q&Aタブ内の質問フォーム */
    .qa-input-section {
      padding: 0.75rem;
      background: var(--surface-muted);
      border-radius: var(--radius);
      margin-bottom: 0.75rem;
    }

    .qa-input-section textarea {
      width: 100%;
      min-height: 60px;
      padding: 0.6rem;
      border: var(--border-width) solid var(--border-color);
      border-radius: var(--radius);
      font-size: 0.9rem;
      resize: vertical;
      background: var(--card-bg);
      color: var(--text);
    }

    .qa-input-section .qa-input-actions {
      display: flex;
      gap: 0.5rem;
      margin-top: 0.5rem;
      align-items: center;
    }

    .qa-input-section .qa-input-hint {
      font-size: 0.7rem;
      color: var(--muted);
      margin-left: auto;
    }

    /* ===== PR-3: 会議モード時の2カラム幅拡大 (Task D) ===== */
    body.meeting-mode .main-content {
      max-width: 1600px;
    }

    /* ===== PCフルサイズ時の横幅拡大（編集モードのみ） ===== */
    @media (min-width: 1200px) {
      body:not(.meeting-mode) .main-container {
        width: min(1800px, calc(100vw - 32px));
        max-width: none;
        padding-left: 1rem;
        padding-right: 1rem;
      }
    }

    /* ===== PR-3: ヘッダー統一感 (Task E) ===== */
    :root {
      --control-h: 42px;
      --control-h-mobile: 38px;
      --btn-radius: 6px; /* デフォルト（テーマで上書き） */
    }

    /* 共通コントロール高さ・角丸 */
    .hdr-btn,
    .header-record .record-btn,
    .meeting-mode-chip,
    .stt-status-chip,
    .header-export .export-btn,
    .header-more-btn,
    .context-btn {
      height: var(--control-h) !important;
      min-height: var(--control-h);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      border-radius: var(--btn-radius) !important;
      padding-left: 0.75rem;
      padding-right: 0.75rem;
    }

    /* ステータスバッジはボタンより少し小さく */
    .header-record .status-badge {
      height: calc(var(--control-h) - 8px) !important;
      min-height: calc(var(--control-h) - 8px);
      border-radius: var(--btn-radius) !important;
    }

    /* ヘッダーrow-2のアイテム整列 */
    .header-row-2 {
      align-items: center;
      gap: 0.5rem;
    }

    .header-record {
      gap: 0.5rem;
      align-items: center;
    }

    @media (max-width: 767px) {
      .hdr-btn,
      .header-record .record-btn,
      .meeting-mode-chip,
      .stt-status-chip,
      .header-export .export-btn,
      .header-more-btn,
      .context-btn {
        height: var(--control-h-mobile) !important;
        min-height: var(--control-h-mobile);
      }

      .header-record .status-badge {
        height: calc(var(--control-h-mobile) - 6px) !important;
        min-height: calc(var(--control-h-mobile) - 6px);
      }
    }

    /* ===== Mobile Header Simplification ===== */
    @media (max-width: 767px) {
      /* 不要な要素を非表示 */
      .header-record .status-badge,
      .header-record .context-btn,
      .header-record .context-status,
      .header-record .enhancement-badge,
      #sttStatusChip,
      #headerSttControls,
      .header-export {
        display: none !important;
      }

      /* ヘッダー2行目を3ボタン専用レイアウトに */
      .header-row-2 {
        display: flex;
        justify-content: center;
        padding: 0.5rem 0.75rem !important;
        gap: 0.5rem;
      }

      .header-record {
        display: flex;
        flex: 1;
        gap: 0.5rem;
        max-width: 100%;
      }

      /* 録音・一時停止・その他ボタンを大きく */
      .header-record .record-btn,
      .header-more-btn {
        flex: 1;
        height: 48px !important;
        min-height: 48px !important;
        font-size: 1rem !important;
        font-weight: 600;
        padding: 0.5rem 0.75rem !important;
        border-radius: 10px !important;
      }

      /* 録音ボタンのラベル表示 */
      .header-record .record-btn .btn-label {
        display: inline !important;
      }

      /* その他ボタンのテキスト表示 */
      .header-more-btn .more-text {
        display: inline !important;
      }
    }
  </style>
</head>
<body>
  <div class="app-wrapper">
  <header class="header">
    <!-- Row 1: ブランド + 設定 -->
    <div class="header-row-1">
      <div class="header-brand">
        <img src="icon-192.png" alt="" class="header-icon">
        <h1 data-i18n="app.title">AI参加会議</h1>
      </div>
      <div class="header-preferences">
        <!-- Hidden preferences (moved to settings) -->
        <div class="hidden-preferences" style="display:none;">
          <button type="button" class="theme-toggle" id="themeToggleBtn" title="ダークモードに切替">🌙</button>
          <select id="languageSwitcher" class="model-select lang-select">
            <option value="ja">🇯🇵 Japanese</option>
            <option value="en">🇺🇸 English</option>
          </select>
          <select id="styleSwitcher" class="model-select" style="font-size:0.85rem; min-width:120px;">
            <option value="brutalism">📦 Brutalism</option>
            <option value="paper">📄 Paper</option>
          </select>
        </div>
        <button type="button" class="quick-settings-btn" id="openLLMSettingsBtn" data-i18n-title="llmModal.title" title="LLM設定">⚡</button>
        <button type="button" class="settings-link" id="openFullSettingsBtn" data-i18n-title="header.fullSettings" title="全設定">⚙️</button>
      </div>
    </div>

    <!-- Row 2: 操作ツールバー -->
    <div class="header-row-2">
      <div class="header-record">
        <button type="button" class="btn btn-primary record-btn" id="recordBtn">
          <span class="btn-icon">🎙️</span>
          <span class="btn-label" data-i18n="app.recording.start">録音開始</span>
        </button>
        <button type="button" class="btn btn-secondary record-btn" id="pauseBtn" style="display: none;">
          <span class="btn-icon">⏸</span>
          <span class="btn-label" data-i18n="app.recording.pause">一時停止</span>
        </button>
        <span class="status-badge status-ready" id="statusBadge">
          <span data-i18n="app.recording.statusReady">待機中</span>
        </span>
        <button type="button" class="meeting-mode-chip" id="meetingModeChip">
          <span class="btn-icon">🎯</span>
          <span class="btn-label" id="meetingModeLabel" data-i18n="app.meeting.meetingMode">会議モード</span>
        </button>
        <button type="button" class="btn btn-ghost context-btn" id="openContextModalBtn">
          📝 <span data-i18n="context.trigger">会議情報を入力</span>
        </button>
        <div class="context-status" id="contextStatusBadge" style="display:none;" data-i18n="context.saved">会議情報を使用中</div>
        <!-- Enhancement バッジ（v3: Issue #14） -->
        <div class="enhancement-badge boost" id="reasoningBoostBadge">Boost ON</div>
        <div class="enhancement-badge native-docs" id="nativeDocsBadge">Native Docs ON</div>
      </div>
      <!-- STT Status Chip (clickable to expand settings) -->
      <button type="button" class="stt-status-chip" id="sttStatusChip" data-i18n-title="config.stt.clickToExpand" title="クリックで設定を展開">
        🎤 <span id="sttStatusLabel">JA / 15s</span>
      </button>
      <!-- STT Controls (hidden by default, shown when chip clicked) -->
      <div class="header-stt-controls collapsed" id="headerSttControls">
        <select id="transcriptProvider" class="model-select" title="STTプロバイダー">
          <option value="openai_stt" selected>🎤 Whisper</option>
          <option value="deepgram_realtime">⚡ Deepgram</option>
        </select>
        <select id="sttLanguage" class="model-select" title="音声言語">
          <option value="ja" selected>🇯🇵 日本語</option>
          <option value="en">🇺🇸 English</option>
          <option value="auto">🌐 Auto</option>
        </select>
        <select id="transcriptInterval" class="model-select" title="送信間隔">
          <option value="5">5秒</option>
          <option value="10">10秒</option>
          <option value="15" selected>15秒</option>
          <option value="30">30秒</option>
          <option value="60">60秒</option>
          <option value="120">2分</option>
        </select>
        <span class="interval-hint" id="intervalHint" style="display: none;">⚡</span>
      </div>
      <div class="header-export">
        <button class="btn btn-secondary export-btn" id="openExportBtn" title="エクスポート">
          <span>📥</span>
          <span class="export-btn-text" data-i18n="common.export">Export</span>
        </button>
      </div>
      <!-- More Menu (Mobile) -->
      <button type="button" class="header-more-btn" id="headerMoreBtn" aria-expanded="false">
        <span>⋯</span>
        <span data-i18n="app.header.more">その他</span>
      </button>
      <div class="header-more-menu" id="headerMoreMenu">
        <button type="button" class="header-more-menu-item" data-action="context">
          📝 <span data-i18n="context.trigger">会議情報を入力</span>
        </button>
        <button type="button" class="header-more-menu-item" data-action="export">
          📥 <span data-i18n="common.export">エクスポート</span>
        </button>
        <button type="button" class="header-more-menu-item" data-action="demo">
          ⚡ <span data-i18n="app.header.demo">30秒デモ</span>
        </button>
        <button type="button" class="header-more-menu-item" data-action="history">
          📚 <span data-i18n="history.open">履歴</span>
        </button>
        <button type="button" class="header-more-menu-item" data-action="settings">
          ⚙️ <span data-i18n="common.settings">設定</span>
        </button>
      </div>
    </div>
  </header>

  <!-- Phase 3: メインパネル切り替えタブ（スマホ専用） -->
  <div class="main-tabs">
    <button class="main-tab active" data-main-tab="transcript">📝 <span data-i18n="app.panel.transcript">文字起こし</span></button>
    <button class="main-tab" data-main-tab="ai">💬 <span data-i18n="app.panel.aiResponse">AI回答</span></button>
  </div>

  <!-- コンテキスト入力モーダル -->
  <div class="modal-overlay" id="contextModal">
    <div class="modal" style="max-width:720px;">
      <div class="modal-header">
        <h2>📝 <span data-i18n="context.modalTitle">会議情報を設定</span></h2>
        <button class="modal-close" id="closeContextModalBtn">×</button>
      </div>
      <div class="modal-body">
        <p style="margin-bottom:0.75rem; color:var(--text-secondary);" data-i18n="context.modalDescription">
          議題や背景を入力すると、AIが文脈を理解した回答を生成できます。
        </p>
        <div class="setting-group">
          <label class="setting-label" for="contextGoalInput" data-i18n="context.goalLabel">議題・ゴール</label>
          <textarea id="contextGoalInput" rows="3" class="input" data-i18n-placeholder="context.goalPlaceholder" placeholder="例: 新商品のネーミング決定、想定顧客像の整理"></textarea>
        </div>
        <div class="setting-group">
          <label class="setting-label" for="contextParticipantsInput" data-i18n="context.participantsLabel">参加者・役割</label>
          <textarea id="contextParticipantsInput" rows="2" class="input" data-i18n-placeholder="context.participantsPlaceholder" placeholder="例: 田中（PM）、佐藤（デザイン）、鈴木（エンジニア）"></textarea>
        </div>
        <div class="setting-group">
          <label class="setting-label" for="contextHandoffInput" data-i18n="context.handoffLabel">引き継ぎ・前提</label>
          <textarea id="contextHandoffInput" rows="2" class="input" data-i18n-placeholder="context.handoffPlaceholder" placeholder="例: 前回の決定事項、未解決の課題、前提条件"></textarea>
        </div>
        <div class="setting-group">
          <label class="setting-label" for="contextReferenceInput" data-i18n="context.referenceLabel">参考テキスト・資料</label>
          <textarea id="contextReferenceInput" rows="4" class="input" data-i18n-placeholder="context.referencePlaceholder" placeholder="必要に応じて企画書や専門用語リストを貼り付け"></textarea>
        </div>

        <!-- ファイルアップロードセクション（強化ON時のみ表示） -->
        <div class="setting-group" id="contextFileUploadSection" style="display:none;">
          <label class="setting-label" data-i18n="context.filesLabel">添付ファイル</label>

          <!-- ドロップゾーン -->
          <div class="file-drop-zone" id="contextDropZone">
            <div class="file-drop-content">
              <span class="file-drop-icon">📁</span>
              <span class="file-drop-text" data-i18n="context.dropZoneText">ここにファイルをドラッグ、またはクリックして選択</span>
              <span class="file-drop-hint" data-i18n="context.dropZoneHint">対応形式: TXT, MD, PDF, DOCX, CSV（各2MBまで）</span>
            </div>
          </div>

          <!-- 隠しファイル入力 -->
          <input type="file" id="contextFileInput" accept=".txt,.md,.pdf,.docx,.csv,text/plain,text/markdown,application/pdf,application/vnd.openxmlformats-officedocument.wordprocessingml.document,text/csv" multiple style="display:none;">

          <!-- ファイル選択ボタン（モバイル用） -->
          <button type="button" class="btn btn-secondary" id="contextSelectFilesBtn" style="width:100%; margin-top:0.5rem;">
            📎 <span data-i18n="context.selectFiles">ファイルを選択</span>
          </button>

          <!-- ファイルリスト -->
          <div class="context-file-list" id="contextFileList"></div>

          <!-- 文字数カウンター -->
          <div class="context-char-counter" id="contextCharCounter">
            <span class="char-count-text">0 / 8,000</span>
            <div class="char-count-bar">
              <div class="char-count-fill" style="width:0%"></div>
            </div>
          </div>
        </div>

        <!-- Enhancements セクション（Issue #14 two-toggles） -->
        <div class="setting-group" style="margin-top:1rem; padding-top:1rem; border-top:1px solid var(--border-color);">
          <label class="setting-label" data-i18n="context.enhancementsLabel">拡張機能</label>

          <!-- Thinking Boost トグル -->
          <div class="toggle-row" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:0.75rem;">
            <div style="flex:1;">
              <span data-i18n="context.reasoningBoostLabel">Thinking強化</span>
              <span class="toggle-hint" style="font-size:0.75rem; color:var(--text-secondary); display:block;" data-i18n="context.reasoningBoostHint">精度向上・時間/コスト増の可能性</span>
              <span class="toggle-disabled-reason" id="reasoningBoostDisabledReason" style="font-size:0.7rem; color:var(--warning); display:none;"></span>
            </div>
            <label class="switch">
              <input type="checkbox" id="reasoningBoostToggle">
              <span class="slider"></span>
            </label>
          </div>

          <!-- Native Docs トグル -->
          <div class="toggle-row" style="display:flex; justify-content:space-between; align-items:center;">
            <div style="flex:1;">
              <span data-i18n="context.nativeDocsLabel">資料そのまま送信</span>
              <span class="toggle-hint" style="font-size:0.75rem; color:var(--text-secondary); display:block;" data-i18n="context.nativeDocsHint">PDFをそのまま送信・精度向上/コスト増の可能性</span>
              <span class="toggle-disabled-reason" id="nativeDocsDisabledReason" style="font-size:0.7rem; color:var(--warning); display:none;"></span>
            </div>
            <label class="switch">
              <input type="checkbox" id="nativeDocsToggle">
              <span class="slider"></span>
            </label>
          </div>
        </div>
      </div>
      <div class="modal-footer" style="justify-content:space-between;">
        <button type="button" class="btn btn-ghost" id="clearContextBtn">🧹 <span data-i18n="context.clear">入力内容を削除</span></button>
        <div style="display:flex; gap:0.5rem;">
          <button type="button" class="btn btn-secondary" id="cancelContextBtn" data-i18n="common.cancel">キャンセル</button>
          <button type="button" class="btn btn-primary" id="saveContextBtn" data-i18n="context.save">設定して閉じる</button>
        </div>
      </div>
    </div>
  </div>

  <main class="main-container">
    <!-- 文字起こしパネル -->
    <div class="panel active" id="transcriptPanel">
      <div class="panel-header">
        <span class="panel-title">📝 <span data-i18n="app.panel.transcript">文字起こし</span></span>
        <div class="panel-actions" style="display:flex; gap:0.5rem;">
          <button class="btn btn-ghost" id="openHistoryBtn" style="font-size:0.75rem;">🗂️ <span data-i18n="history.open">履歴</span></button>
          <button class="btn btn-ghost" id="clearTranscriptBtn" style="font-size: 0.75rem;" data-i18n="common.clear">クリア</button>
        </div>
      </div>
      <div class="meeting-title-row" style="display:flex; gap:0.5rem; align-items:center; margin:0.5rem 0;">
        <label for="meetingTitleInput" class="meeting-title-label" style="font-size:0.9rem; color:var(--text-secondary);">
          <span data-i18n="history.titleLabel">会議タイトル</span>
        </label>
        <input type="text" id="meetingTitleInput" class="input" style="flex:1;" data-i18n-placeholder="history.titlePlaceholder" placeholder="例: 営業定例 (2026/01/06)">
      </div>
      <div class="panel-body" id="transcriptBody">
        <div class="transcript-text" id="transcriptText"><span class="transcript-placeholder" id="transcriptPlaceholder" data-i18n="app.transcript.placeholder">録音を開始すると、ここに文字起こしが表示されます...</span></div>
      </div>
      <!-- Cost Chip Bar (compact) -->
      <div class="cost-chip-bar">
        <button class="cost-chip" id="transcriptCostChip" type="button">
          <span>STT</span>
          <span class="chip-cost-value" data-mirror="transcriptCostTotal">¥0</span>
          <span class="chip-cost-badge" data-mirror-class="transcriptCostBadge">低</span>
        </button>
      </div>
      <!-- Original cost display (hidden, kept for JS compatibility) -->
      <div class="cost-display" id="transcriptCostPanel" style="display:none">
        <div class="cost-header" data-cost-target="transcript">
          <span>💰 <span data-i18n="app.cost.transcriptCost">文字起こしコスト</span></span>
          <span><span id="transcriptCostTotal">¥0</span> <span id="transcriptCostBadge" class="cost-badge cost-badge-low" data-i18n="app.cost.low">低</span></span>
        </div>
        <div class="cost-details" id="transcriptCostDetails">
          <div class="cost-section">
            <div class="cost-section-title">📊 <span data-i18n="app.cost.usage">使用量</span></div>
            <div class="cost-item">
              <span class="cost-item-label" data-i18n="app.cost.processingTime">処理時間:</span>
              <span id="transcriptDuration">0秒</span>
            </div>
            <div class="cost-item">
              <span class="cost-item-label" data-i18n="app.cost.apiCalls">API呼び出し:</span>
              <span id="transcriptCalls">0回</span>
            </div>
          </div>
          <div class="cost-section">
            <div class="cost-section-title">💵 <span data-i18n="app.cost.byProvider">プロバイダー別</span></div>
            <div class="cost-item">
              <span class="cost-item-label">OpenAI Whisper:</span>
              <span id="openaiTranscriptCost">¥0</span>
            </div>
            <div class="cost-item">
              <span class="cost-item-label">Deepgram:</span>
              <span id="deepgramTranscriptCost">¥0</span>
            </div>
          </div>
          <div class="cost-section">
            <div class="cost-section-title">📈 レート</div>
            <div class="cost-item">
              <span class="cost-item-label">Whisper:</span>
              <span>¥0.9/分</span>
            </div>
            <div class="cost-item">
              <span class="cost-item-label">Deepgram:</span>
              <span>~¥0.36/分</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- AIパネル -->
    <div class="panel" id="aiPanel">
      <div class="panel-header">
        <span class="panel-title">💬 <span data-i18n="app.panel.aiResponse">AI回答</span></span>
        <span class="llm-indicator" id="llmIndicator" title="使用中のLLM">🤖 未設定</span>
      </div>

      <!-- 非表示の互換用要素（既存JSとの互換性維持） -->
      <div style="display:none;">
        <textarea id="customQuestion"></textarea>
        <button id="askCustomBtn"></button>
        <div id="memoInputSection"><textarea id="memoInput"></textarea><button id="submitMemoBtn"></button></div>
      </div>

      <div class="tabs">
        <button class="tab active" data-tab="summary"><span data-i18n="app.ai.tabs.summary">要約</span></button>
        <button class="tab" data-tab="consult"><span data-i18n="app.ai.tabs.consult">相談</span></button>
        <button class="tab" data-tab="custom"><span data-i18n="app.ai.tabs.qa">Q&A</span></button>
        <button class="tab" data-tab="memo"><span data-i18n="app.ai.tabs.memo">メモ</span></button>
        <button class="tab" data-tab="timeline"><span data-i18n="app.ai.tabs.timeline">タイムライン</span></button>
        <button class="tab" data-tab="minutes"><span data-i18n="app.ai.tabs.minutes">議事録</span></button>
      </div>

      <div class="tab-content active" id="tab-summary">
        <button class="regenerate-btn" id="regenerateSummaryBtn" style="display:none;" data-ai-type="summary" title="再生成">↻ <span data-i18n="app.ai.regenerate">再生成</span></button>
        <div class="empty-state" id="emptySummary">
          <div class="empty-state-icon">📋</div>
          <div class="empty-state-title" data-i18n="app.ai.empty.summaryTitle">まだ要約がありません</div>
          <div class="empty-state-desc" data-i18n="app.ai.empty.summaryDesc">現在までの会話内容から要約を作成します</div>
          <button class="btn btn-primary" id="tabSummaryBtn" data-ai-type="summary">📋 <span data-i18n="app.ai.generateSummary">要約を生成</span></button>
        </div>
        <div class="ai-response" id="response-summary"></div>
      </div>
      <div class="tab-content" id="tab-consult">
        <button class="regenerate-btn" id="regenerateConsultBtn" style="display:none;" data-ai-type="consult" title="再生成">↻ <span data-i18n="app.ai.regenerate">再生成</span></button>
        <div class="empty-state" id="emptyConsult">
          <div class="empty-state-icon">💭</div>
          <div class="empty-state-title" data-i18n="app.ai.empty.consultTitle">AIに相談する</div>
          <div class="empty-state-desc" data-i18n="app.ai.empty.consultDesc">会議の内容についてAIにアドバイスを求めます</div>
          <button class="btn btn-primary" id="tabConsultBtn" data-ai-type="consult">💭 <span data-i18n="app.ai.generateConsult">相談を生成</span></button>
        </div>
        <div class="ai-response" id="response-consult"></div>
      </div>
      <div class="tab-content" id="tab-memo">
        <div class="memo-input-section" style="display: block; border-top: none; margin-top: 0; padding-top: 0;">
          <div class="memo-input-row">
            <textarea id="memoInputInTab" rows="3" data-i18n-placeholder="app.ai.memoPlaceholder" placeholder="メモを追加...（選択テキストがあれば引用付き）"></textarea>
            <button type="button" class="btn btn-primary" id="submitMemoInTabBtn" data-i18n="common.send">追加</button>
          </div>
        </div>
        <div id="memoListInTab" class="timeline-list"></div>
      </div>
      <div class="tab-content" id="tab-minutes">
        <button class="regenerate-btn" id="regenerateMinutesBtn" style="display:none;" data-ai-type="minutes" title="再生成">↻ <span data-i18n="app.ai.regenerate">再生成</span></button>
        <div class="empty-state" id="emptyMinutes">
          <div class="empty-state-icon">📄</div>
          <div class="empty-state-title" data-i18n="app.ai.empty.minutesTitle">議事録を作成</div>
          <div class="empty-state-desc" data-i18n="app.ai.empty.minutesDesc">フォーマットに沿って議事録を出力します。録音停止後に生成できます。</div>
          <button class="btn btn-primary" id="tabMinutesBtn" data-ai-type="minutes" disabled data-i18n-title="toast.qa.minutesAfterStop">📄 <span data-i18n="app.ai.generateMinutes">議事録を生成</span></button>
        </div>
        <div class="ai-response" id="response-minutes"></div>
      </div>
      <div class="tab-content" id="tab-custom">
        <div class="qa-input-section">
          <textarea id="qaInputInTab" data-i18n-placeholder="app.ai.customPlaceholder" placeholder="自由に質問...（文字起こしをコピペして該当箇所を聞くことも可能）" rows="3"></textarea>
          <div class="qa-input-actions">
            <button type="button" class="btn btn-primary" id="qaSubmitInTabBtn" data-i18n="common.send">送信</button>
            <span class="qa-input-hint">Ctrl+Enter / Cmd+Enter</span>
          </div>
        </div>
        <div id="qa-history"></div>
      </div>
      <div class="tab-content" id="tab-timeline">
        <div class="timeline-controls">
          <div class="timeline-filters">
            <button class="timeline-filter active" data-filter="all" data-i18n="app.timeline.filterAll">全部</button>
            <button class="timeline-filter" data-filter="memo" data-i18n="app.timeline.filterMemo">メモ</button>
            <button class="timeline-filter" data-filter="todo" data-i18n="app.timeline.filterTodo">TODO</button>
            <button class="timeline-filter" data-filter="ai" data-i18n="app.timeline.filterAI">AI</button>
            <button class="timeline-filter" data-filter="qa" data-i18n="app.timeline.filterQA">Q&A</button>
          </div>
          <input type="text" id="timelineSearch" class="input" data-i18n-placeholder="app.timeline.searchPlaceholder" placeholder="キーワード検索..." style="margin-top:0.5rem;">
        </div>
        <div class="timeline-list" id="timelineList"></div>
      </div>

      <!-- Cost Chip Bar (compact) -->
      <div class="cost-chip-bar">
        <button class="cost-chip" id="llmCostChip" type="button">
          <span>LLM</span>
          <span class="chip-cost-value" data-mirror="llmCostTotal">¥0</span>
          <span class="chip-cost-badge" data-mirror-class="llmCostBadge">低</span>
        </button>
        <span class="cost-total-inline">合計: <span data-mirror="totalCost">¥0</span></span>
        <span id="costWarningInline"></span>
      </div>
      <!-- Original cost display (hidden, kept for JS compatibility) -->
      <div class="cost-display" id="llmCostPanel" style="display:none">
        <div class="cost-header" data-cost-target="llm">
          <span>💰 <span data-i18n="app.cost.llmCost">LLMコスト</span></span>
          <span><span id="llmCostTotal">¥0</span> <span id="llmCostBadge" class="cost-badge cost-badge-low" data-i18n="app.cost.low">低</span></span>
        </div>
        <div class="cost-details" id="llmCostDetails">
          <div class="cost-section">
            <div class="cost-section-title">📊 <span data-i18n="app.cost.usage">使用量</span></div>
            <div class="cost-item">
              <span class="cost-item-label" data-i18n="export.document.costInputTokens">入力トークン:</span>
              <span id="llmInputTokens">0</span>
            </div>
            <div class="cost-item">
              <span class="cost-item-label" data-i18n="export.document.costOutputTokens">出力トークン:</span>
              <span id="llmOutputTokens">0</span>
            </div>
            <div class="cost-item">
              <span class="cost-item-label" data-i18n="app.cost.apiCalls">API呼び出し:</span>
              <span id="llmCalls">0回</span>
            </div>
          </div>
          <div class="cost-section">
            <div class="cost-section-title">💵 <span data-i18n="app.cost.byProvider">プロバイダー別</span></div>
            <div class="cost-item">
              <span class="cost-item-label">Gemini:</span>
              <span id="geminiLlmCost">¥0</span>
            </div>
            <div class="cost-item">
              <span class="cost-item-label">Claude:</span>
              <span id="claudeCost">¥0</span>
            </div>
            <div class="cost-item">
              <span class="cost-item-label">OpenAI:</span>
              <span id="openaiCost">¥0</span>
            </div>
            <div class="cost-item">
              <span class="cost-item-label">Groq:</span>
              <span id="groqCost">¥0</span>
            </div>
          </div>
        </div>
        <div class="cost-row cost-total" style="margin-top: 0.5rem;">
          <span>📊 <span data-i18n="app.cost.total">合計概算</span>:</span>
          <span id="totalCost">¥0</span>
        </div>
        <div id="costWarning" class="cost-warning" style="display: none;">
        </div>
      </div>
    </div>
  </main>

  <!-- フッター -->
  <footer style="text-align: center; padding: 1rem; font-size: 0.75rem; color: var(--text-secondary); border-top: 1px solid var(--border); background: var(--card-bg);">
    <div style="display: flex; justify-content: center; gap: 1.5rem; flex-wrap: wrap;">
      <a href="docs/TERMS.md" target="_blank" style="color: var(--text-secondary); text-decoration: none;" data-i18n="footer.terms">利用規約</a>
      <a href="docs/PRIVACY.md" target="_blank" style="color: var(--text-secondary); text-decoration: none;" data-i18n="footer.privacy">プライバシーポリシー</a>
      <a href="docs/SECURITY.md" target="_blank" style="color: var(--text-secondary); text-decoration: none;" data-i18n="footer.security">セキュリティ</a>
      <a href="https://github.com/gatyoukatyou/ai-meeting-assistant" target="_blank" rel="noopener" style="color: var(--text-secondary); text-decoration: none;">GitHub</a>
    </div>
    <div style="margin-top: 0.5rem;" data-i18n="footer.copyright">
      © 2024 AI参加会議 | MITライセンス
    </div>
  </footer>
  </div><!-- /.app-wrapper -->

  <!-- ウェルカムモーダル -->
  <div class="modal-overlay" id="welcomeModal">
    <div class="modal">
      <div class="modal-header">
        <h2>🤖 <span data-i18n="modal.welcome.title">AI参加会議へようこそ</span></h2>
        <button class="modal-close" id="closeWelcomeModalBtn">×</button>
      </div>
      <div class="modal-body">
        <div class="welcome-content">
          <p class="welcome-desc" data-i18n="modal.welcome.description">会議中にAIがリアルタイムで参加し、文字起こし・要約・意見・アイデア提案を行います</p>

          <div class="welcome-features">
            <div class="welcome-feature">
              <span class="welcome-feature-icon">🎤</span>
              <span class="welcome-feature-text" data-i18n="modal.welcome.feature1">高精度な音声文字起こし（OpenAI Whisper / Deepgram）</span>
            </div>
            <div class="welcome-feature">
              <span class="welcome-feature-icon">🧠</span>
              <span class="welcome-feature-text" data-i18n="modal.welcome.feature2">複数のAIモデルに対応</span>
            </div>
            <div class="welcome-feature">
              <span class="welcome-feature-icon">🔒</span>
              <span class="welcome-feature-text" data-i18n="modal.welcome.feature3">APIキーはセッション内のみ保持</span>
            </div>
            <div class="welcome-feature">
              <span class="welcome-feature-icon">💰</span>
              <span class="welcome-feature-text" data-i18n="modal.welcome.feature4">利用料金の概算をリアルタイム表示</span>
            </div>
          </div>

          <div style="margin-top: 1rem; font-size: 0.75rem; color: var(--text-secondary); text-align: center;">
            利用開始により、<a href="docs/TERMS.md" target="_blank" style="color: var(--primary);">利用規約</a>と<a href="docs/PRIVACY.md" target="_blank" style="color: var(--primary);">プライバシーポリシー</a>に同意したものとみなされます。
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-ghost" id="loadDemoSessionBtn">⚡ <span data-i18n="modal.welcome.demoButton">30秒デモを試す</span></button>
        <button class="btn btn-secondary" id="skipWelcomeBtn" data-i18n="modal.welcome.skipButton">後で設定する</button>
        <a href="config.html" class="btn btn-primary">⚙️ <span data-i18n="modal.welcome.startButton">設定を開始する</span></a>
      </div>
    </div>
  </div>


  <!-- エクスポートモーダル -->
  <div class="modal-overlay" id="exportModal">
    <div class="modal" style="max-width: 700px;">
      <div class="modal-header">
        <h2>📥 <span data-i18n="export.title">エクスポート</span></h2>
        <button class="modal-close" id="closeExportModalBtn">×</button>
      </div>
      <div class="modal-body">
        <!-- 項目選択 -->
        <div class="setting-group">
          <label class="setting-label" data-i18n="export.selectItems">出力項目を選択</label>
          <div class="export-options">
            <label class="export-option">
              <input type="checkbox" id="exportMinutes" checked>
              <span>📄 <span data-i18n="export.items.minutes">議事録</span></span>
            </label>
            <label class="export-option">
              <input type="checkbox" id="exportSummary" checked>
              <span>📋 <span data-i18n="export.items.summary">要約</span></span>
            </label>
            <label class="export-option">
              <input type="checkbox" id="exportConsult" checked>
              <span>💭 <span data-i18n="export.items.consult">相談</span></span>
            </label>
            <label class="export-option">
              <input type="checkbox" id="exportMemos" checked>
              <span>📝 <span data-i18n="export.items.memos">メモ</span></span>
            </label>
            <label class="export-option">
              <input type="checkbox" id="exportTodos" checked>
              <span>☑️ <span data-i18n="export.items.todos">TODO</span></span>
            </label>
            <label class="export-option">
              <input type="checkbox" id="exportQA" checked>
              <span>❓ <span data-i18n="export.items.qa">Q&A</span></span>
            </label>
            <label class="export-option">
              <input type="checkbox" id="exportTranscript" checked>
              <span>📜 <span data-i18n="export.items.transcript">文字起こし</span></span>
            </label>
            <label class="export-option">
              <input type="checkbox" id="exportAiWorkOrder" checked>
              <span>🧭 <span data-i18n="export.items.aiWorkOrder">AIワークオーダー</span></span>
            </label>
            <label class="export-option">
              <input type="checkbox" id="exportCost" checked>
              <span>💰 <span data-i18n="export.items.cost">コスト詳細</span></span>
            </label>
          </div>
          <div class="export-presets">
            <button class="btn btn-ghost btn-sm" id="exportPresetAll" data-i18n="export.presets.all">全選択</button>
            <button class="btn btn-ghost btn-sm" id="exportPresetClear" data-i18n="export.presets.clear">クリア</button>
          </div>
        </div>
        <!-- プレビュー -->
        <div class="setting-group">
          <label class="setting-label" data-i18n="export.preview">プレビュー</label>
          <div class="export-preview" id="exportPreview"></div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" id="closeExportModalFooterBtn" data-i18n="common.close">閉じる</button>
        <button class="btn btn-primary" id="downloadExportBtn">📥 <span data-i18n="common.download">ダウンロード</span></button>
      </div>
    </div>
  </div>

<!-- 履歴モーダル -->
  <div class="modal-overlay" id="historyModal">
    <div class="modal" style="max-width:700px;">
      <div class="modal-header">
        <h2>🗂️ <span data-i18n="history.modalTitle">会議履歴</span></h2>
        <button class="modal-close" id="closeHistoryModalBtn">×</button>
      </div>
      <div class="modal-body">
        <p style="margin-bottom:0.75rem; font-size:0.9rem; color:var(--text-secondary);" data-i18n="history.modalDescription">最大5件まで自動保存され、古い履歴から削除されます。</p>
        <div id="historyList" class="history-list" data-i18n-empty="history.empty" style="display:flex; flex-direction:column; gap:0.75rem;"></div>
      </div>
      <div class="modal-footer" style="justify-content:space-between;">
        <button class="btn btn-ghost" id="clearHistoryBtn">🧹 <span data-i18n="history.clearAll">履歴を全て削除</span></button>
        <div style="display:flex; gap:0.5rem; flex-wrap:wrap; justify-content:flex-end;">
          <button class="btn btn-secondary" id="copyDiagnosticPackBtn">🩺 <span data-i18n="history.diagnosticCopy">診断パックをコピー</span></button>
          <button class="btn btn-secondary" id="downloadDiagnosticPackBtn">💾 <span data-i18n="history.diagnosticDownload">診断JSON保存</span></button>
          <button class="btn btn-secondary" id="downloadHistoryBackupBtn">🗄️ <span data-i18n="history.backupDownload">履歴バックアップJSON</span></button>
          <button class="btn btn-secondary" id="importHistoryBackupBtn">♻️ <span data-i18n="history.backupRestore">バックアップJSON復元</span></button>
          <input type="file" id="importHistoryBackupInput" accept=".json,application/json" style="display:none;">
          <button class="btn btn-secondary" id="importHistoryBtn">📂 <span data-i18n="history.import">MDファイルを読み込む</span></button>
          <input type="file" id="importFileInput" accept=".md,text/markdown" style="display:none;">
          <button class="btn btn-secondary" id="closeHistoryModalFooterBtn" data-i18n="common.close">閉じる</button>
        </div>
      </div>
    </div>
  </div>

  <!-- LLM設定モーダル -->
  <div class="modal-overlay" id="llmSettingsModal">
    <div class="modal" style="max-width: 450px;">
      <div class="modal-header">
        <h2>⚡ <span data-i18n="llmModal.title">LLM設定</span></h2>
        <button class="modal-close" id="closeLLMModalBtn">×</button>
      </div>
      <div class="modal-body">
        <div class="setting-group">
          <label class="setting-label" data-i18n="llmModal.selectProvider">プロバイダーを選択</label>
          <div class="llm-provider-tabs">
            <button type="button" class="llm-provider-tab active" data-provider="gemini">Gemini</button>
            <button type="button" class="llm-provider-tab" data-provider="claude">Claude</button>
            <button type="button" class="llm-provider-tab" data-provider="openai_llm">OpenAI</button>
            <button type="button" class="llm-provider-tab" data-provider="groq">Groq</button>
          </div>
        </div>
        <div class="setting-group">
          <label class="setting-label" data-i18n="llmModal.apiKey">APIキー</label>
          <input type="password" class="setting-input" id="llmModalApiKey" placeholder="APIキーを入力">
          <div class="setting-hint llm-key-hint" id="llmKeyHint"></div>
        </div>
        <div class="setting-group">
          <label class="setting-label" data-i18n="llmModal.model">モデル</label>
          <select class="setting-input model-select" id="llmModalModel"></select>
        </div>
        <div class="setting-group" style="margin-top: 1rem; padding: 0.75rem; background: var(--accent-blue); border-radius: 0.5rem; border: 1px solid var(--accent-border-blue);">
          <div style="font-size: 0.8rem; color: var(--text-secondary);" data-i18n="llmModal.hint">
            💡 録音中でもLLM設定を変更できます。次回のAI呼び出しから新しい設定が適用されます。
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" id="closeLLMModalFooterBtn" data-i18n="common.cancel">キャンセル</button>
        <button class="btn btn-primary" id="saveLLMModalBtn">💾 <span data-i18n="common.save">保存</span></button>
      </div>
    </div>
  </div>

  <!-- Issue #40: Fatal error modal -->
  <div class="modal-overlay" id="fatalErrorModal" style="display: none;">
    <div class="modal" style="max-width: 400px;">
      <div class="modal-header">
        <h2 data-i18n="app.error.fatalTitle">エラーが発生しました</h2>
      </div>
      <div class="modal-body">
        <p style="margin-bottom: 1rem;" data-i18n="app.error.fatalBody">
          予期しないエラーが発生しました。録音中の場合は自動停止されました。
        </p>
        <div style="display: flex; flex-direction: column; gap: 0.75rem;">
          <button class="btn btn-primary" id="resetSessionBtn">
            <span data-i18n="app.error.resetSession">セッションをリセット</span>
          </button>
          <button class="btn btn-secondary" id="reloadPageBtn">
            <span data-i18n="app.error.reloadPage">ページを再読み込み</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- トースト通知コンテナ -->
  <div class="toast-container" id="toastContainer"></div>

  <!-- Phase 2: フローティング停止ボタン（録音中のみ表示） -->
  <button class="btn btn-danger floating-stop-btn" id="floatingStopBtn">
    ⏹ <span data-i18n="app.recording.stop">録音停止</span>
  </button>

  <!-- Phase 5: 会議中モード切替ボタン（録音中のみ表示） -->
  <button class="btn meeting-mode-toggle" id="meetingModeToggle">
    🎯 <span data-i18n="app.meeting.modeButton">会議中モード</span>
  </button>

  <!-- Phase 5: 会議中モードオーバーレイ -->
  <div class="meeting-mode-overlay" id="meetingModeOverlay">
    <div class="meeting-mode-status">
      <div class="meeting-mode-icon" id="meetingModeStatusIcon">🔴</div>
      <div class="meeting-mode-text" id="meetingModeStatusText" data-i18n="app.meeting.recording">録音中</div>
      <div class="meeting-mode-time" id="meetingModeTime">00:00:00</div>
      <div class="meeting-mode-hint" id="meetingModeFocusHint" data-i18n="app.meeting.focusHint">会議に集中してください</div>
    </div>
    <button class="btn btn-danger meeting-mode-stop-btn" id="meetingModeStopBtn">
      ⏹ <span data-i18n="app.recording.stop">録音停止</span>
    </button>
    <button class="meeting-mode-exit-btn" id="meetingModeExitBtn">
      ← <span data-i18n="app.meeting.returnButton">通常画面に戻る</span>
    </button>
  </div>

  <!-- Cost Popover (shared) -->
  <div class="cost-popover" id="costPopover">
    <div id="costPopoverContent"></div>
  </div>
  <script src="js/i18n.js"></script>
  <script src="js/theme.js"></script>
  <script src="js/debug-logger.js"></script>
  <script src="js/secure-storage.js" defer></script>
  <script src="js/history-store.js" defer></script>
  <!-- Model Registry (A+B auto-detection) -->
  <script src="js/model-registry.js" defer></script>
  <!-- STT Provider抽象化レイヤー -->
  <script src="js/audio/pcm_stream.js" defer></script>
  <script src="js/audio/recording_monitor.js" defer></script>
  <script src="js/stt/index.js" defer></script>
  <script src="js/stt/providers/openai_chunked.js" defer></script>
  <script src="js/stt/providers/deepgram_ws.js" defer></script>
  <!-- ファイル抽出 -->
  <script src="js/file-extractor.js" defer></script>
  <!-- メインアプリ -->
  <script src="js/app.js" defer></script>
</body>
</html>
