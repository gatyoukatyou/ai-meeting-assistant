<!DOCTYPE html>
<html lang="ja" data-i18n-title="app.pageTitle" data-style="brutalism">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta http-equiv="Content-Security-Policy"
        content="default-src 'self'; base-uri 'self'; object-src 'none'; form-action 'self'; script-src 'self'; connect-src 'self' https://generativelanguage.googleapis.com https://api.openai.com https://api.groq.com https://api.anthropic.com wss://api.deepgram.com https://api.deepgram.com; img-src 'self' data:; style-src 'self' 'unsafe-inline'; font-src 'self' data:; manifest-src 'self';">

  <!-- PWA Manifest -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#4f46e5">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="AI会議">

  <title>AI参加会議</title>
  <link rel="stylesheet" href="css/index.css">
</head>
<body>
  <div class="app-wrapper">
  <header class="header">
    <!-- Row 1: ブランド + 設定 -->
    <div class="header-row-1">
      <div class="header-brand">
        <img src="icon-192.png" alt="" class="header-icon">
        <h1 data-i18n="app.title">AI参加会議</h1>
      </div>
      <div class="header-preferences">
        <!-- Hidden preferences (moved to settings) -->
        <div class="hidden-preferences" style="display:none;">
          <button type="button" class="theme-toggle" id="themeToggleBtn" title="ダークモードに切替">🌙</button>
          <select id="languageSwitcher" class="model-select lang-select">
            <option value="ja">🇯🇵 Japanese</option>
            <option value="en">🇺🇸 English</option>
          </select>
          <select id="styleSwitcher" class="model-select" style="font-size:0.85rem; min-width:120px;">
            <option value="brutalism">📦 Brutalism</option>
            <option value="paper">📄 Paper</option>
          </select>
        </div>
        <button type="button" class="quick-settings-btn" id="openLLMSettingsBtn" data-i18n-title="llmModal.title" title="LLM設定">⚡</button>
        <button type="button" class="settings-link" id="openFullSettingsBtn" data-i18n-title="header.fullSettings" title="全設定">⚙️</button>
      </div>
    </div>

    <!-- Row 2: 操作ツールバー -->
    <div class="header-row-2">
      <div class="header-record">
        <button type="button" class="btn btn-primary record-btn" id="recordBtn">
          <span class="btn-icon">🎙️</span>
          <span class="btn-label" data-i18n="app.recording.start">録音開始</span>
        </button>
        <button type="button" class="btn btn-secondary record-btn" id="pauseBtn" style="display: none;">
          <span class="btn-icon">⏸</span>
          <span class="btn-label" data-i18n="app.recording.pause">一時停止</span>
        </button>
        <span class="status-badge status-ready" id="statusBadge">
          <span data-i18n="app.recording.statusReady">待機中</span>
        </span>
        <button type="button" class="meeting-mode-chip" id="meetingModeChip">
          <span class="btn-icon">🎯</span>
          <span class="btn-label" id="meetingModeLabel" data-i18n="app.meeting.meetingMode">会議モード</span>
        </button>
        <button type="button" class="btn btn-ghost context-btn" id="openContextModalBtn">
          📝 <span data-i18n="context.trigger">会議情報を入力</span>
        </button>
        <div class="context-status" id="contextStatusBadge" style="display:none;" data-i18n="context.saved">会議情報を使用中</div>
        <!-- Enhancement バッジ（v3: Issue #14） -->
        <div class="enhancement-badge boost" id="reasoningBoostBadge">Boost ON</div>
        <div class="enhancement-badge native-docs" id="nativeDocsBadge">Native Docs ON</div>
      </div>
      <!-- STT Status Chip (clickable to expand settings) -->
      <button type="button" class="stt-status-chip" id="sttStatusChip" data-i18n-title="config.stt.clickToExpand" title="クリックで設定を展開">
        🎤 <span id="sttStatusLabel">JA / 15s</span>
      </button>
      <!-- STT Controls (hidden by default, shown when chip clicked) -->
      <div class="header-stt-controls collapsed" id="headerSttControls">
        <select id="transcriptProvider" class="model-select" title="STTプロバイダー">
          <option value="openai_stt" selected>🎤 Whisper</option>
          <option value="deepgram_realtime">⚡ Deepgram</option>
        </select>
        <select id="sttLanguage" class="model-select" title="音声言語">
          <option value="ja" selected>🇯🇵 日本語</option>
          <option value="en">🇺🇸 English</option>
          <option value="auto">🌐 Auto</option>
        </select>
        <select id="transcriptInterval" class="model-select" title="送信間隔">
          <option value="5">5秒</option>
          <option value="10">10秒</option>
          <option value="15" selected>15秒</option>
          <option value="30">30秒</option>
          <option value="60">60秒</option>
          <option value="120">2分</option>
        </select>
        <span class="interval-hint" id="intervalHint" style="display: none;">⚡</span>
      </div>
      <div class="header-export">
        <button class="btn btn-secondary export-btn" id="openExportBtn" title="エクスポート">
          <span>📥</span>
          <span class="export-btn-text" data-i18n="common.export">Export</span>
        </button>
      </div>
      <!-- More Menu (Mobile) -->
      <button type="button" class="header-more-btn" id="headerMoreBtn" aria-expanded="false">
        <span>⋯</span>
        <span data-i18n="app.header.more">その他</span>
      </button>
      <div class="header-more-menu" id="headerMoreMenu">
        <button type="button" class="header-more-menu-item" data-action="context">
          📝 <span data-i18n="context.trigger">会議情報を入力</span>
        </button>
        <button type="button" class="header-more-menu-item" data-action="export">
          📥 <span data-i18n="common.export">エクスポート</span>
        </button>
        <button type="button" class="header-more-menu-item" data-action="demo">
          ⚡ <span data-i18n="app.header.demo">30秒デモ</span>
        </button>
        <button type="button" class="header-more-menu-item" data-action="history">
          📚 <span data-i18n="history.open">履歴</span>
        </button>
        <button type="button" class="header-more-menu-item" data-action="settings">
          ⚙️ <span data-i18n="common.settings">設定</span>
        </button>
      </div>
    </div>
  </header>

  <!-- Phase 3: メインパネル切り替えタブ（スマホ専用） -->
  <div class="main-tabs">
    <button class="main-tab active" data-main-tab="transcript">📝 <span data-i18n="app.panel.transcript">文字起こし</span></button>
    <button class="main-tab" data-main-tab="ai">💬 <span data-i18n="app.panel.aiResponse">AI回答</span></button>
  </div>

  <!-- コンテキスト入力モーダル -->
  <div class="modal-overlay" id="contextModal">
    <div class="modal" style="max-width:720px;">
      <div class="modal-header">
        <h2>📝 <span data-i18n="context.modalTitle">会議情報を設定</span></h2>
        <button class="modal-close" id="closeContextModalBtn">×</button>
      </div>
      <div class="modal-body">
        <p style="margin-bottom:0.75rem; color:var(--text-secondary);" data-i18n="context.modalDescription">
          議題や背景を入力すると、AIが文脈を理解した回答を生成できます。
        </p>
        <div class="setting-group">
          <label class="setting-label" for="contextGoalInput" data-i18n="context.goalLabel">議題・ゴール</label>
          <textarea id="contextGoalInput" rows="3" class="input" data-i18n-placeholder="context.goalPlaceholder" placeholder="例: 新商品のネーミング決定、想定顧客像の整理"></textarea>
        </div>
        <div class="setting-group">
          <label class="setting-label" for="contextParticipantsInput" data-i18n="context.participantsLabel">参加者・役割</label>
          <textarea id="contextParticipantsInput" rows="2" class="input" data-i18n-placeholder="context.participantsPlaceholder" placeholder="例: 田中（PM）、佐藤（デザイン）、鈴木（エンジニア）"></textarea>
        </div>
        <div class="setting-group">
          <label class="setting-label" for="contextHandoffInput" data-i18n="context.handoffLabel">引き継ぎ・前提</label>
          <textarea id="contextHandoffInput" rows="2" class="input" data-i18n-placeholder="context.handoffPlaceholder" placeholder="例: 前回の決定事項、未解決の課題、前提条件"></textarea>
        </div>
        <div class="setting-group">
          <label class="setting-label" for="contextReferenceInput" data-i18n="context.referenceLabel">参考テキスト・資料</label>
          <textarea id="contextReferenceInput" rows="4" class="input" data-i18n-placeholder="context.referencePlaceholder" placeholder="必要に応じて企画書や専門用語リストを貼り付け"></textarea>
        </div>

        <!-- ファイルアップロードセクション（強化ON時のみ表示） -->
        <div class="setting-group" id="contextFileUploadSection" style="display:none;">
          <label class="setting-label" data-i18n="context.filesLabel">添付ファイル</label>

          <!-- ドロップゾーン -->
          <div class="file-drop-zone" id="contextDropZone">
            <div class="file-drop-content">
              <span class="file-drop-icon">📁</span>
              <span class="file-drop-text" data-i18n="context.dropZoneText">ここにファイルをドラッグ、またはクリックして選択</span>
              <span class="file-drop-hint" data-i18n="context.dropZoneHint">対応形式: TXT, MD, PDF, DOCX, CSV（各2MBまで）</span>
            </div>
          </div>

          <!-- 隠しファイル入力 -->
          <input type="file" id="contextFileInput" accept=".txt,.md,.pdf,.docx,.csv,text/plain,text/markdown,application/pdf,application/vnd.openxmlformats-officedocument.wordprocessingml.document,text/csv" multiple style="display:none;">

          <!-- ファイル選択ボタン（モバイル用） -->
          <button type="button" class="btn btn-secondary" id="contextSelectFilesBtn" style="width:100%; margin-top:0.5rem;">
            📎 <span data-i18n="context.selectFiles">ファイルを選択</span>
          </button>

          <!-- ファイルリスト -->
          <div class="context-file-list" id="contextFileList"></div>

          <!-- 文字数カウンター -->
          <div class="context-char-counter" id="contextCharCounter">
            <span class="char-count-text">0 / 8,000</span>
            <div class="char-count-bar">
              <div class="char-count-fill" style="width:0%"></div>
            </div>
          </div>
        </div>

        <!-- Enhancements セクション（Issue #14 two-toggles） -->
        <div class="setting-group" style="margin-top:1rem; padding-top:1rem; border-top:1px solid var(--border-color);">
          <label class="setting-label" data-i18n="context.enhancementsLabel">拡張機能</label>

          <!-- Thinking Boost トグル -->
          <div class="toggle-row" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:0.75rem;">
            <div style="flex:1;">
              <span data-i18n="context.reasoningBoostLabel">Thinking強化</span>
              <span class="toggle-hint" style="font-size:0.75rem; color:var(--text-secondary); display:block;" data-i18n="context.reasoningBoostHint">精度向上・時間/コスト増の可能性</span>
              <span class="toggle-disabled-reason" id="reasoningBoostDisabledReason" style="font-size:0.7rem; color:var(--warning); display:none;"></span>
            </div>
            <label class="switch">
              <input type="checkbox" id="reasoningBoostToggle">
              <span class="slider"></span>
            </label>
          </div>

          <!-- Native Docs トグル -->
          <div class="toggle-row" style="display:flex; justify-content:space-between; align-items:center;">
            <div style="flex:1;">
              <span data-i18n="context.nativeDocsLabel">資料そのまま送信</span>
              <span class="toggle-hint" style="font-size:0.75rem; color:var(--text-secondary); display:block;" data-i18n="context.nativeDocsHint">PDFをそのまま送信・精度向上/コスト増の可能性</span>
              <span class="toggle-hint" style="font-size:0.72rem; color:var(--text-secondary); display:block;" data-i18n="context.nativeDocsApiGuide">必要API: Gemini API（モデル例: gemini-2.5-flash / gemini-2.5-pro）</span>
              <span class="toggle-disabled-reason" id="nativeDocsDisabledReason" style="font-size:0.7rem; color:var(--warning); display:none;"></span>
            </div>
            <label class="switch">
              <input type="checkbox" id="nativeDocsToggle">
              <span class="slider"></span>
            </label>
          </div>
        </div>
      </div>
      <div class="modal-footer" style="justify-content:space-between;">
        <button type="button" class="btn btn-ghost" id="clearContextBtn">🧹 <span data-i18n="context.clear">入力内容を削除</span></button>
        <div style="display:flex; gap:0.5rem;">
          <button type="button" class="btn btn-secondary" id="cancelContextBtn" data-i18n="common.cancel">キャンセル</button>
          <button type="button" class="btn btn-primary" id="saveContextBtn" data-i18n="context.save">設定して閉じる</button>
        </div>
      </div>
    </div>
  </div>

  <main class="main-container">
    <!-- 文字起こしパネル -->
    <div class="panel active" id="transcriptPanel">
      <div class="panel-header">
        <span class="panel-title">📝 <span data-i18n="app.panel.transcript">文字起こし</span></span>
        <div class="panel-actions" style="display:flex; gap:0.5rem;">
          <button class="btn btn-ghost" id="openHistoryBtn" style="font-size:0.75rem;">🗂️ <span data-i18n="history.open">履歴</span></button>
          <button class="btn btn-ghost" id="clearTranscriptBtn" style="font-size: 0.75rem;" data-i18n="common.clear">クリア</button>
        </div>
      </div>
      <div class="meeting-title-row" style="display:flex; gap:0.5rem; align-items:center; margin:0.5rem 0;">
        <label for="meetingTitleInput" class="meeting-title-label" style="font-size:0.9rem; color:var(--text-secondary);">
          <span data-i18n="history.titleLabel">会議タイトル</span>
        </label>
        <input type="text" id="meetingTitleInput" class="input" style="flex:1;" data-i18n-placeholder="history.titlePlaceholder" placeholder="例: 営業定例 (2026/01/06)">
      </div>
      <div class="panel-body" id="transcriptBody">
        <div class="transcript-text" id="transcriptText"><span class="transcript-placeholder" id="transcriptPlaceholder" data-i18n="app.transcript.placeholder">録音を開始すると、ここに文字起こしが表示されます...</span></div>
      </div>
      <!-- Cost Chip Bar (compact) -->
      <div class="cost-chip-bar">
        <button class="cost-chip" id="transcriptCostChip" type="button">
          <span>STT</span>
          <span class="chip-cost-value" data-mirror="transcriptCostTotal">¥0</span>
          <span class="chip-cost-badge" data-mirror-class="transcriptCostBadge">低</span>
        </button>
      </div>
      <!-- Original cost display (hidden, kept for JS compatibility) -->
      <div class="cost-display" id="transcriptCostPanel" style="display:none">
        <div class="cost-header" data-cost-target="transcript">
          <span>💰 <span data-i18n="app.cost.transcriptCost">文字起こしコスト</span></span>
          <span><span id="transcriptCostTotal">¥0</span> <span id="transcriptCostBadge" class="cost-badge cost-badge-low" data-i18n="app.cost.low">低</span></span>
        </div>
        <div class="cost-details" id="transcriptCostDetails">
          <div class="cost-section">
            <div class="cost-section-title">📊 <span data-i18n="app.cost.usage">使用量</span></div>
            <div class="cost-item">
              <span class="cost-item-label" data-i18n="app.cost.processingTime">処理時間:</span>
              <span id="transcriptDuration">0秒</span>
            </div>
            <div class="cost-item">
              <span class="cost-item-label" data-i18n="app.cost.apiCalls">API呼び出し:</span>
              <span id="transcriptCalls">0回</span>
            </div>
          </div>
          <div class="cost-section">
            <div class="cost-section-title">💵 <span data-i18n="app.cost.byProvider">プロバイダー別</span></div>
            <div class="cost-item">
              <span class="cost-item-label">OpenAI Whisper:</span>
              <span id="openaiTranscriptCost">¥0</span>
            </div>
            <div class="cost-item">
              <span class="cost-item-label">Deepgram:</span>
              <span id="deepgramTranscriptCost">¥0</span>
            </div>
          </div>
          <div class="cost-section">
            <div class="cost-section-title">📈 レート</div>
            <div class="cost-item">
              <span class="cost-item-label">Whisper:</span>
              <span>¥0.9/分</span>
            </div>
            <div class="cost-item">
              <span class="cost-item-label">Deepgram:</span>
              <span>~¥0.36/分</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- AIパネル -->
    <div class="panel" id="aiPanel">
      <div class="panel-header">
        <span class="panel-title">💬 <span data-i18n="app.panel.aiResponse">AI回答</span></span>
        <span class="llm-indicator" id="llmIndicator" title="使用中のLLM">🤖 未設定</span>
      </div>

      <!-- 非表示の互換用要素（既存JSとの互換性維持） -->
      <div style="display:none;">
        <textarea id="customQuestion"></textarea>
        <button id="askCustomBtn"></button>
        <div id="memoInputSection"><textarea id="memoInput"></textarea><button id="submitMemoBtn"></button></div>
      </div>

      <div class="tabs">
        <button class="tab active" data-tab="summary"><span data-i18n="app.ai.tabs.summary">要約</span></button>
        <button class="tab" data-tab="consult"><span data-i18n="app.ai.tabs.consult">相談</span></button>
        <button class="tab" data-tab="custom"><span data-i18n="app.ai.tabs.qa">Q&A</span></button>
        <button class="tab" data-tab="memo"><span data-i18n="app.ai.tabs.memo">メモ</span></button>
        <button class="tab" data-tab="timeline"><span data-i18n="app.ai.tabs.timeline">タイムライン</span></button>
        <button class="tab" data-tab="minutes"><span data-i18n="app.ai.tabs.minutes">議事録</span></button>
      </div>

      <div class="tab-content active" id="tab-summary">
        <button class="regenerate-btn" id="regenerateSummaryBtn" style="display:none;" data-ai-type="summary" title="再生成">↻ <span data-i18n="app.ai.regenerate">再生成</span></button>
        <div class="empty-state" id="emptySummary">
          <div class="empty-state-icon">📋</div>
          <div class="empty-state-title" data-i18n="app.ai.empty.summaryTitle">まだ要約がありません</div>
          <div class="empty-state-desc" data-i18n="app.ai.empty.summaryDesc">現在までの会話内容から要約を作成します</div>
          <button class="btn btn-primary" id="tabSummaryBtn" data-ai-type="summary">📋 <span data-i18n="app.ai.generateSummary">要約を生成</span></button>
        </div>
        <div class="ai-response" id="response-summary"></div>
      </div>
      <div class="tab-content" id="tab-consult">
        <button class="regenerate-btn" id="regenerateConsultBtn" style="display:none;" data-ai-type="consult" title="再生成">↻ <span data-i18n="app.ai.regenerate">再生成</span></button>
        <div class="empty-state" id="emptyConsult">
          <div class="empty-state-icon">💭</div>
          <div class="empty-state-title" data-i18n="app.ai.empty.consultTitle">AIに相談する</div>
          <div class="empty-state-desc" data-i18n="app.ai.empty.consultDesc">会議の内容についてAIにアドバイスを求めます</div>
          <button class="btn btn-primary" id="tabConsultBtn" data-ai-type="consult">💭 <span data-i18n="app.ai.generateConsult">相談を生成</span></button>
        </div>
        <div class="ai-response" id="response-consult"></div>
      </div>
      <div class="tab-content" id="tab-memo">
        <div class="memo-input-section" style="display: block; border-top: none; margin-top: 0; padding-top: 0;">
          <div class="memo-input-row">
            <textarea id="memoInputInTab" rows="3" data-i18n-placeholder="app.ai.memoPlaceholder" placeholder="メモを追加...（選択テキストがあれば引用付き）"></textarea>
            <button type="button" class="btn btn-primary" id="submitMemoInTabBtn" data-i18n="common.send">追加</button>
          </div>
        </div>
        <div id="memoListInTab" class="timeline-list"></div>
      </div>
      <div class="tab-content" id="tab-minutes">
        <button class="regenerate-btn" id="regenerateMinutesBtn" style="display:none;" data-ai-type="minutes" title="再生成">↻ <span data-i18n="app.ai.regenerate">再生成</span></button>
        <div class="empty-state" id="emptyMinutes">
          <div class="empty-state-icon">📄</div>
          <div class="empty-state-title" data-i18n="app.ai.empty.minutesTitle">議事録を作成</div>
          <div class="empty-state-desc" data-i18n="app.ai.empty.minutesDesc">フォーマットに沿って議事録を出力します。録音停止後に生成できます。</div>
          <button class="btn btn-primary" id="tabMinutesBtn" data-ai-type="minutes" disabled data-i18n-title="toast.qa.minutesAfterStop">📄 <span data-i18n="app.ai.generateMinutes">議事録を生成</span></button>
        </div>
        <div class="ai-response" id="response-minutes"></div>
      </div>
      <div class="tab-content" id="tab-custom">
        <div class="qa-input-section">
          <textarea id="qaInputInTab" data-i18n-placeholder="app.ai.customPlaceholder" placeholder="自由に質問...（文字起こしをコピペして該当箇所を聞くことも可能）" rows="3"></textarea>
          <div class="qa-input-actions">
            <button type="button" class="btn btn-primary" id="qaSubmitInTabBtn" data-i18n="common.send">送信</button>
            <span class="qa-input-hint">Ctrl+Enter / Cmd+Enter</span>
          </div>
        </div>
        <div id="qa-history"></div>
      </div>
      <div class="tab-content" id="tab-timeline">
        <div class="timeline-controls">
          <div class="timeline-filters">
            <button class="timeline-filter active" data-filter="all" data-i18n="app.timeline.filterAll">全部</button>
            <button class="timeline-filter" data-filter="memo" data-i18n="app.timeline.filterMemo">メモ</button>
            <button class="timeline-filter" data-filter="todo" data-i18n="app.timeline.filterTodo">TODO</button>
            <button class="timeline-filter" data-filter="ai" data-i18n="app.timeline.filterAI">AI</button>
            <button class="timeline-filter" data-filter="qa" data-i18n="app.timeline.filterQA">Q&A</button>
          </div>
          <input type="text" id="timelineSearch" class="input" data-i18n-placeholder="app.timeline.searchPlaceholder" placeholder="キーワード検索..." style="margin-top:0.5rem;">
        </div>
        <div class="timeline-list" id="timelineList"></div>
      </div>

      <!-- Cost Chip Bar (compact) -->
      <div class="cost-chip-bar">
        <button class="cost-chip" id="llmCostChip" type="button">
          <span>LLM</span>
          <span class="chip-cost-value" data-mirror="llmCostTotal">¥0</span>
          <span class="chip-cost-badge" data-mirror-class="llmCostBadge">低</span>
        </button>
        <span class="cost-total-inline">合計: <span data-mirror="totalCost">¥0</span></span>
        <span id="costWarningInline"></span>
      </div>
      <!-- Original cost display (hidden, kept for JS compatibility) -->
      <div class="cost-display" id="llmCostPanel" style="display:none">
        <div class="cost-header" data-cost-target="llm">
          <span>💰 <span data-i18n="app.cost.llmCost">LLMコスト</span></span>
          <span><span id="llmCostTotal">¥0</span> <span id="llmCostBadge" class="cost-badge cost-badge-low" data-i18n="app.cost.low">低</span></span>
        </div>
        <div class="cost-details" id="llmCostDetails">
          <div class="cost-section">
            <div class="cost-section-title">📊 <span data-i18n="app.cost.usage">使用量</span></div>
            <div class="cost-item">
              <span class="cost-item-label" data-i18n="export.document.costInputTokens">入力トークン:</span>
              <span id="llmInputTokens">0</span>
            </div>
            <div class="cost-item">
              <span class="cost-item-label" data-i18n="export.document.costOutputTokens">出力トークン:</span>
              <span id="llmOutputTokens">0</span>
            </div>
            <div class="cost-item">
              <span class="cost-item-label" data-i18n="app.cost.apiCalls">API呼び出し:</span>
              <span id="llmCalls">0回</span>
            </div>
          </div>
          <div class="cost-section">
            <div class="cost-section-title">💵 <span data-i18n="app.cost.byProvider">プロバイダー別</span></div>
            <div class="cost-item">
              <span class="cost-item-label">Gemini:</span>
              <span id="geminiLlmCost">¥0</span>
            </div>
            <div class="cost-item">
              <span class="cost-item-label">Claude:</span>
              <span id="claudeCost">¥0</span>
            </div>
            <div class="cost-item">
              <span class="cost-item-label">OpenAI:</span>
              <span id="openaiCost">¥0</span>
            </div>
            <div class="cost-item">
              <span class="cost-item-label">Groq:</span>
              <span id="groqCost">¥0</span>
            </div>
          </div>
        </div>
        <div class="cost-row cost-total" style="margin-top: 0.5rem;">
          <span>📊 <span data-i18n="app.cost.total">合計概算</span>:</span>
          <span id="totalCost">¥0</span>
        </div>
        <div id="costWarning" class="cost-warning" style="display: none;">
        </div>
      </div>
    </div>
  </main>

  <!-- フッター -->
  <footer style="text-align: center; padding: 1rem; font-size: 0.75rem; color: var(--text-secondary); border-top: 1px solid var(--border); background: var(--card-bg);">
    <div style="display: flex; justify-content: center; gap: 1.5rem; flex-wrap: wrap;">
      <a href="docs/TERMS.md" target="_blank" style="color: var(--text-secondary); text-decoration: none;" data-i18n="footer.terms">利用規約</a>
      <a href="docs/PRIVACY.md" target="_blank" style="color: var(--text-secondary); text-decoration: none;" data-i18n="footer.privacy">プライバシーポリシー</a>
      <a href="docs/SECURITY.md" target="_blank" style="color: var(--text-secondary); text-decoration: none;" data-i18n="footer.security">セキュリティ</a>
      <a href="https://github.com/gatyoukatyou/ai-meeting-assistant" target="_blank" rel="noopener" style="color: var(--text-secondary); text-decoration: none;">GitHub</a>
    </div>
    <div style="margin-top: 0.5rem;" data-i18n="footer.copyright">
      © 2024 AI参加会議 | MITライセンス
    </div>
  </footer>
  </div><!-- /.app-wrapper -->

  <!-- ウェルカムモーダル -->
  <div class="modal-overlay" id="welcomeModal">
    <div class="modal">
      <div class="modal-header">
        <h2>🤖 <span data-i18n="modal.welcome.title">AI参加会議へようこそ</span></h2>
        <button class="modal-close" id="closeWelcomeModalBtn">×</button>
      </div>
      <div class="modal-body">
        <div class="welcome-content">
          <p class="welcome-desc" data-i18n="modal.welcome.description">会議中にAIがリアルタイムで参加し、文字起こし・要約・意見・アイデア提案を行います</p>

          <div class="welcome-features">
            <div class="welcome-feature">
              <span class="welcome-feature-icon">🎤</span>
              <span class="welcome-feature-text" data-i18n="modal.welcome.feature1">高精度な音声文字起こし（OpenAI Whisper / Deepgram）</span>
            </div>
            <div class="welcome-feature">
              <span class="welcome-feature-icon">🧠</span>
              <span class="welcome-feature-text" data-i18n="modal.welcome.feature2">複数のAIモデルに対応</span>
            </div>
            <div class="welcome-feature">
              <span class="welcome-feature-icon">🔒</span>
              <span class="welcome-feature-text" data-i18n="modal.welcome.feature3">APIキーはセッション内のみ保持</span>
            </div>
            <div class="welcome-feature">
              <span class="welcome-feature-icon">💰</span>
              <span class="welcome-feature-text" data-i18n="modal.welcome.feature4">利用料金の概算をリアルタイム表示</span>
            </div>
          </div>

          <div style="margin-top: 1rem; font-size: 0.75rem; color: var(--text-secondary); text-align: center;">
            利用開始により、<a href="docs/TERMS.md" target="_blank" style="color: var(--primary);">利用規約</a>と<a href="docs/PRIVACY.md" target="_blank" style="color: var(--primary);">プライバシーポリシー</a>に同意したものとみなされます。
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-ghost" id="loadDemoSessionBtn">⚡ <span data-i18n="modal.welcome.demoButton">30秒デモを試す</span></button>
        <button class="btn btn-secondary" id="skipWelcomeBtn" data-i18n="modal.welcome.skipButton">後で設定する</button>
        <a href="config.html" class="btn btn-primary">⚙️ <span data-i18n="modal.welcome.startButton">設定を開始する</span></a>
      </div>
    </div>
  </div>


  <!-- エクスポートモーダル -->
  <div class="modal-overlay" id="exportModal">
    <div class="modal" style="max-width: 700px;">
      <div class="modal-header">
        <h2>📥 <span data-i18n="export.title">エクスポート</span></h2>
        <button class="modal-close" id="closeExportModalBtn">×</button>
      </div>
      <div class="modal-body">
        <!-- 項目選択 -->
        <div class="setting-group">
          <label class="setting-label" data-i18n="export.selectItems">出力項目を選択</label>
          <div class="export-options">
            <label class="export-option">
              <input type="checkbox" id="exportMinutes" checked>
              <span>📄 <span data-i18n="export.items.minutes">議事録</span></span>
            </label>
            <label class="export-option">
              <input type="checkbox" id="exportSummary" checked>
              <span>📋 <span data-i18n="export.items.summary">要約</span></span>
            </label>
            <label class="export-option">
              <input type="checkbox" id="exportConsult" checked>
              <span>💭 <span data-i18n="export.items.consult">相談</span></span>
            </label>
            <label class="export-option">
              <input type="checkbox" id="exportMemos" checked>
              <span>📝 <span data-i18n="export.items.memos">メモ</span></span>
            </label>
            <label class="export-option">
              <input type="checkbox" id="exportTodos" checked>
              <span>☑️ <span data-i18n="export.items.todos">TODO</span></span>
            </label>
            <label class="export-option">
              <input type="checkbox" id="exportQA" checked>
              <span>❓ <span data-i18n="export.items.qa">Q&A</span></span>
            </label>
            <label class="export-option">
              <input type="checkbox" id="exportTranscript" checked>
              <span>📜 <span data-i18n="export.items.transcript">文字起こし</span></span>
            </label>
            <label class="export-option">
              <input type="checkbox" id="exportAiWorkOrder" checked>
              <span>🧭 <span data-i18n="export.items.aiWorkOrder">AIワークオーダー</span></span>
            </label>
            <label class="export-option">
              <input type="checkbox" id="exportCost" checked>
              <span>💰 <span data-i18n="export.items.cost">コスト詳細</span></span>
            </label>
          </div>
          <div class="export-presets">
            <button class="btn btn-ghost btn-sm" id="exportPresetAll" data-i18n="export.presets.all">全選択</button>
            <button class="btn btn-ghost btn-sm" id="exportPresetClear" data-i18n="export.presets.clear">クリア</button>
          </div>
        </div>
        <!-- プレビュー -->
        <div class="setting-group">
          <label class="setting-label" data-i18n="export.preview">プレビュー</label>
          <div class="export-preview" id="exportPreview"></div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" id="closeExportModalFooterBtn" data-i18n="common.close">閉じる</button>
        <button class="btn btn-primary" id="downloadExportBtn">📥 <span data-i18n="common.download">ダウンロード</span></button>
      </div>
    </div>
  </div>

<!-- 履歴モーダル -->
  <div class="modal-overlay" id="historyModal">
    <div class="modal" style="max-width:700px;">
      <div class="modal-header">
        <h2>🗂️ <span data-i18n="history.modalTitle">会議履歴</span></h2>
        <button class="modal-close" id="closeHistoryModalBtn">×</button>
      </div>
      <div class="modal-body">
        <p style="margin-bottom:0.75rem; font-size:0.9rem; color:var(--text-secondary);" data-i18n="history.modalDescription">最大5件まで自動保存され、古い履歴から削除されます。</p>
        <div id="historyList" class="history-list" data-i18n-empty="history.empty" style="display:flex; flex-direction:column; gap:0.75rem;"></div>
      </div>
      <div class="modal-footer" style="justify-content:space-between;">
        <button class="btn btn-ghost" id="clearHistoryBtn">🧹 <span data-i18n="history.clearAll">履歴を全て削除</span></button>
        <div style="display:flex; gap:0.5rem; flex-wrap:wrap; justify-content:flex-end;">
          <button class="btn btn-secondary" id="copyDiagnosticPackBtn">🩺 <span data-i18n="history.diagnosticCopy">診断パックをコピー</span></button>
          <button class="btn btn-secondary" id="downloadDiagnosticPackBtn">💾 <span data-i18n="history.diagnosticDownload">診断JSON保存</span></button>
          <button class="btn btn-secondary" id="downloadHistoryBackupBtn">🗄️ <span data-i18n="history.backupDownload">履歴バックアップJSON</span></button>
          <button class="btn btn-secondary" id="importHistoryBackupBtn">♻️ <span data-i18n="history.backupRestore">バックアップJSON復元</span></button>
          <input type="file" id="importHistoryBackupInput" accept=".json,application/json" style="display:none;">
          <button class="btn btn-secondary" id="importHistoryBtn">📂 <span data-i18n="history.import">MDファイルを読み込む</span></button>
          <input type="file" id="importFileInput" accept=".md,text/markdown" style="display:none;">
          <button class="btn btn-secondary" id="closeHistoryModalFooterBtn" data-i18n="common.close">閉じる</button>
        </div>
      </div>
    </div>
  </div>

  <!-- LLM設定モーダル -->
  <div class="modal-overlay" id="llmSettingsModal">
    <div class="modal" style="max-width: 450px;">
      <div class="modal-header">
        <h2>⚡ <span data-i18n="llmModal.title">LLM設定</span></h2>
        <button class="modal-close" id="closeLLMModalBtn">×</button>
      </div>
      <div class="modal-body">
        <div class="setting-group">
          <label class="setting-label" data-i18n="llmModal.selectProvider">プロバイダーを選択</label>
          <div class="llm-provider-tabs">
            <button type="button" class="llm-provider-tab active" data-provider="gemini">Gemini</button>
            <button type="button" class="llm-provider-tab" data-provider="claude">Claude</button>
            <button type="button" class="llm-provider-tab" data-provider="openai_llm">OpenAI</button>
            <button type="button" class="llm-provider-tab" data-provider="groq">Groq</button>
          </div>
        </div>
        <div class="setting-group">
          <label class="setting-label" data-i18n="llmModal.apiKey">APIキー</label>
          <input type="password" class="setting-input" id="llmModalApiKey" placeholder="APIキーを入力">
          <div class="setting-hint llm-key-hint" id="llmKeyHint"></div>
        </div>
        <div class="setting-group">
          <label class="setting-label" data-i18n="llmModal.model">モデル</label>
          <select class="setting-input model-select" id="llmModalModel"></select>
        </div>
        <div class="setting-group" style="margin-top: 1rem; padding: 0.75rem; background: var(--accent-blue); border-radius: 0.5rem; border: 1px solid var(--accent-border-blue);">
          <div style="font-size: 0.8rem; color: var(--text-secondary);" data-i18n="llmModal.hint">
            💡 録音中でもLLM設定を変更できます。次回のAI呼び出しから新しい設定が適用されます。
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" id="closeLLMModalFooterBtn" data-i18n="common.cancel">キャンセル</button>
        <button class="btn btn-primary" id="saveLLMModalBtn">💾 <span data-i18n="common.save">保存</span></button>
      </div>
    </div>
  </div>

  <!-- Issue #40: Fatal error modal -->
  <div class="modal-overlay" id="fatalErrorModal" style="display: none;">
    <div class="modal" style="max-width: 400px;">
      <div class="modal-header">
        <h2 data-i18n="app.error.fatalTitle">エラーが発生しました</h2>
      </div>
      <div class="modal-body">
        <p style="margin-bottom: 1rem;" data-i18n="app.error.fatalBody">
          予期しないエラーが発生しました。録音中の場合は自動停止されました。
        </p>
        <div style="display: flex; flex-direction: column; gap: 0.75rem;">
          <button class="btn btn-primary" id="resetSessionBtn">
            <span data-i18n="app.error.resetSession">セッションをリセット</span>
          </button>
          <button class="btn btn-secondary" id="reloadPageBtn">
            <span data-i18n="app.error.reloadPage">ページを再読み込み</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- トースト通知コンテナ -->
  <div class="toast-container" id="toastContainer"></div>

  <!-- Phase 2: フローティング停止ボタン（録音中のみ表示） -->
  <button class="btn btn-danger floating-stop-btn" id="floatingStopBtn">
    ⏹ <span data-i18n="app.recording.stop">録音停止</span>
  </button>

  <!-- Phase 5: 会議中モード切替ボタン（録音中のみ表示） -->
  <button class="btn meeting-mode-toggle" id="meetingModeToggle">
    🎯 <span data-i18n="app.meeting.modeButton">会議中モード</span>
  </button>

  <!-- Phase 5: 会議中モードオーバーレイ -->
  <div class="meeting-mode-overlay" id="meetingModeOverlay">
    <div class="meeting-mode-status">
      <div class="meeting-mode-icon" id="meetingModeStatusIcon">🔴</div>
      <div class="meeting-mode-text" id="meetingModeStatusText" data-i18n="app.meeting.recording">録音中</div>
      <div class="meeting-mode-time" id="meetingModeTime">00:00:00</div>
      <div class="meeting-mode-hint" id="meetingModeFocusHint" data-i18n="app.meeting.focusHint">会議に集中してください</div>
    </div>
    <button class="btn btn-danger meeting-mode-stop-btn" id="meetingModeStopBtn">
      ⏹ <span data-i18n="app.recording.stop">録音停止</span>
    </button>
    <button class="meeting-mode-exit-btn" id="meetingModeExitBtn">
      ← <span data-i18n="app.meeting.returnButton">通常画面に戻る</span>
    </button>
  </div>

  <!-- Cost Popover (shared) -->
  <div class="cost-popover" id="costPopover">
    <div id="costPopoverContent"></div>
  </div>
  <script src="js/i18n.js"></script>
  <script src="js/theme.js"></script>
  <script src="js/debug-logger.js"></script>
  <script src="js/lib/provider-catalog.js" defer></script>
  <script src="js/stores/model-registry-cache-store.js" defer></script>
  <script src="js/stores/meeting-context-store.js" defer></script>
  <script src="js/stores/meeting-title-store.js" defer></script>
  <script src="js/secure-storage.js" defer></script>
  <script src="js/history-store.js" defer></script>
  <!-- Model Registry (A+B auto-detection) -->
  <script src="js/model-registry.js" defer></script>
  <!-- STT Provider抽象化レイヤー -->
  <script src="js/audio/pcm_stream.js" defer></script>
  <script src="js/audio/recording_monitor.js" defer></script>
  <script src="js/stt/index.js" defer></script>
  <script src="js/stt/providers/openai_chunked.js" defer></script>
  <script src="js/stt/providers/deepgram_ws.js" defer></script>
  <!-- ファイル抽出 -->
  <script src="js/file-extractor.js" defer></script>
  <!-- フォーマットユーティリティ -->
  <script src="js/lib/format-utils.js" defer></script>
  <!-- 能力判定ユーティリティ -->
  <script src="js/lib/capability-utils.js" defer></script>
  <!-- サニタイズユーティリティ -->
  <script src="js/lib/sanitize-utils.js" defer></script>
  <!-- モデルユーティリティ -->
  <script src="js/lib/model-utils.js" defer></script>
  <!-- テキストユーティリティ -->
  <script src="js/lib/text-utils.js" defer></script>
  <!-- サービス層（DOM非依存ロジック） -->
  <script src="js/services/llm-client.js" defer></script>
  <script src="js/services/meeting-context-service.js" defer></script>
  <script src="js/services/export-service.js" defer></script>
  <script src="js/services/diagnostics-service.js" defer></script>
  <!-- メインアプリ -->
  <script src="js/app.js" defer></script>
</body>
</html>
